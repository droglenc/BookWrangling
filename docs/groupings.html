<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 8 Groupings | Readings for MTH250 - Data Wrangling</title>
  <meta name="description" content="This book contains the readings for MTH250W at Northland College." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 8 Groupings | Readings for MTH250 - Data Wrangling" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://derekogle.com/BookWrangling/" />
  
  <meta property="og:description" content="This book contains the readings for MTH250W at Northland College." />
  <meta name="github-repo" content="droglenc/BookWrangling" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 8 Groupings | Readings for MTH250 - Data Wrangling" />
  
  <meta name="twitter:description" content="This book contains the readings for MTH250W at Northland College." />
  

<meta name="author" content="Derek H. Ogle" />


<meta name="date" content="2021-08-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="wrangle-rows.html"/>
<link rel="next" href="dates-and-times.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Readings for Data Wrangling in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="preparation.html"><a href="preparation.html"><i class="fa fa-check"></i><b>1</b> Preparation</a></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Data Structures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#vectors"><i class="fa fa-check"></i><b>2.1</b> Vectors</a></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#data-classes"><i class="fa fa-check"></i><b>2.2</b> Data Classes</a></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#data-frames"><i class="fa fa-check"></i><b>2.3</b> Data Frames</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#tidy-data"><i class="fa fa-check"></i><b>2.4</b> Tidy Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="read-external-data-files.html"><a href="read-external-data-files.html"><i class="fa fa-check"></i><b>3</b> Read External Data Files</a>
<ul>
<li class="chapter" data-level="3.1" data-path="read-external-data-files.html"><a href="read-external-data-files.html#entering-data"><i class="fa fa-check"></i><b>3.1</b> Entering Data</a></li>
<li class="chapter" data-level="3.2" data-path="read-external-data-files.html"><a href="read-external-data-files.html#saving-the-external-file"><i class="fa fa-check"></i><b>3.2</b> Saving the External File</a></li>
<li class="chapter" data-level="3.3" data-path="read-external-data-files.html"><a href="read-external-data-files.html#reading-the-external-file"><i class="fa fa-check"></i><b>3.3</b> Reading the External File</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="relational-data.html"><a href="relational-data.html"><i class="fa fa-check"></i><b>4</b> Relational Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="relational-data.html"><a href="relational-data.html#join-concepts"><i class="fa fa-check"></i><b>4.1</b> Join Concepts</a></li>
<li class="chapter" data-level="4.2" data-path="relational-data.html"><a href="relational-data.html#joins-in-r"><i class="fa fa-check"></i><b>4.2</b> Joins in R</a></li>
<li class="chapter" data-level="4.3" data-path="relational-data.html"><a href="relational-data.html#examples-with-context"><i class="fa fa-check"></i><b>4.3</b> Examples With Context</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="pivot.html"><a href="pivot.html"><i class="fa fa-check"></i><b>5</b> Pivot</a>
<ul>
<li class="chapter" data-level="5.1" data-path="pivot.html"><a href="pivot.html#data-formats"><i class="fa fa-check"></i><b>5.1</b> Data Formats</a></li>
<li class="chapter" data-level="5.2" data-path="pivot.html"><a href="pivot.html#pivoting-concepts"><i class="fa fa-check"></i><b>5.2</b> Pivoting Concepts</a></li>
<li class="chapter" data-level="5.3" data-path="pivot.html"><a href="pivot.html#pivoting-in-r"><i class="fa fa-check"></i><b>5.3</b> Pivoting in R</a></li>
<li class="chapter" data-level="5.4" data-path="pivot.html"><a href="pivot.html#pivoting-examples"><i class="fa fa-check"></i><b>5.4</b> Examples with Context</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="wrangle-columns.html"><a href="wrangle-columns.html"><i class="fa fa-check"></i><b>6</b> Wrangle Columns</a>
<ul>
<li class="chapter" data-level="6.1" data-path="wrangle-columns.html"><a href="wrangle-columns.html#dplyr-verbs"><i class="fa fa-check"></i><b>6.1</b> <code>dplyr</code> verbs</a></li>
<li class="chapter" data-level="6.2" data-path="wrangle-columns.html"><a href="wrangle-columns.html#pipe"><i class="fa fa-check"></i><b>6.2</b> Pipe</a></li>
<li class="chapter" data-level="6.3" data-path="wrangle-columns.html"><a href="wrangle-columns.html#selecting-variables"><i class="fa fa-check"></i><b>6.3</b> Selecting Variables</a></li>
<li class="chapter" data-level="6.4" data-path="wrangle-columns.html"><a href="wrangle-columns.html#moving-variables"><i class="fa fa-check"></i><b>6.4</b> Moving Variables</a></li>
<li class="chapter" data-level="6.5" data-path="wrangle-columns.html"><a href="wrangle-columns.html#renaming-variables"><i class="fa fa-check"></i><b>6.5</b> Renaming Variables</a></li>
<li class="chapter" data-level="6.6" data-path="wrangle-columns.html"><a href="wrangle-columns.html#adding-variables"><i class="fa fa-check"></i><b>6.6</b> Adding Variables</a></li>
<li class="chapter" data-level="6.7" data-path="wrangle-columns.html"><a href="wrangle-columns.html#columns-examples"><i class="fa fa-check"></i><b>6.7</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wrangle-rows.html"><a href="wrangle-rows.html"><i class="fa fa-check"></i><b>7</b> Wrangle Rows</a>
<ul>
<li class="chapter" data-level="7.1" data-path="wrangle-rows.html"><a href="wrangle-rows.html#filtering-rows"><i class="fa fa-check"></i><b>7.1</b> Filtering Rows</a></li>
<li class="chapter" data-level="7.2" data-path="wrangle-rows.html"><a href="wrangle-rows.html#arranging-rows"><i class="fa fa-check"></i><b>7.2</b> Arranging Rows</a></li>
<li class="chapter" data-level="7.3" data-path="wrangle-rows.html"><a href="wrangle-rows.html#appending-rows"><i class="fa fa-check"></i><b>7.3</b> Appending Rows</a></li>
<li class="chapter" data-level="7.4" data-path="wrangle-rows.html"><a href="wrangle-rows.html#examples-in-context"><i class="fa fa-check"></i><b>7.4</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="groupings.html"><a href="groupings.html"><i class="fa fa-check"></i><b>8</b> Groupings</a>
<ul>
<li class="chapter" data-level="8.1" data-path="groupings.html"><a href="groupings.html#declaring-groupings"><i class="fa fa-check"></i><b>8.1</b> Declaring Groupings</a></li>
<li class="chapter" data-level="8.2" data-path="groupings.html"><a href="groupings.html#summarizing-by-groups"><i class="fa fa-check"></i><b>8.2</b> Summarizing by Groups</a></li>
<li class="chapter" data-level="8.3" data-path="groupings.html"><a href="groupings.html#wrangling-by-group"><i class="fa fa-check"></i><b>8.3</b> Wrangling by Group</a></li>
<li class="chapter" data-level="8.4" data-path="groupings.html"><a href="groupings.html#ungrouping"><i class="fa fa-check"></i><b>8.4</b> Ungrouping</a></li>
<li class="chapter" data-level="8.5" data-path="groupings.html"><a href="groupings.html#examples-in-context-1"><i class="fa fa-check"></i><b>8.5</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>9</b> Dates and Times</a>
<ul>
<li class="chapter" data-level="9.1" data-path="dates-and-times.html"><a href="dates-and-times.html#obtaining-dates-data"><i class="fa fa-check"></i><b>9.1</b> Obtaining Dates Data</a></li>
<li class="chapter" data-level="9.2" data-path="dates-and-times.html"><a href="dates-and-times.html#extracting-date-components"><i class="fa fa-check"></i><b>9.2</b> Extracting Date Components</a></li>
<li class="chapter" data-level="9.3" data-path="dates-and-times.html"><a href="dates-and-times.html#calculations-with-dates"><i class="fa fa-check"></i><b>9.3</b> Calculations with Dates</a></li>
<li class="chapter" data-level="9.4" data-path="dates-and-times.html"><a href="dates-and-times.html#obtaining-time-data"><i class="fa fa-check"></i><b>9.4</b> Obtaining Time Data</a></li>
<li class="chapter" data-level="9.5" data-path="dates-and-times.html"><a href="dates-and-times.html#extracting-time-components"><i class="fa fa-check"></i><b>9.5</b> Extracting Time Components</a></li>
<li class="chapter" data-level="9.6" data-path="dates-and-times.html"><a href="dates-and-times.html#calculations-with-date-times"><i class="fa fa-check"></i><b>9.6</b> Calculations with Date-Times</a></li>
<li class="chapter" data-level="9.7" data-path="dates-and-times.html"><a href="dates-and-times.html#examples-in-context-2"><i class="fa fa-check"></i><b>9.7</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>10</b> Factors</a>
<ul>
<li class="chapter" data-level="10.1" data-path="factors.html"><a href="factors.html#creating-factors"><i class="fa fa-check"></i><b>10.1</b> Creating Factors</a></li>
<li class="chapter" data-level="10.2" data-path="factors.html"><a href="factors.html#changing-factor-order"><i class="fa fa-check"></i><b>10.2</b> Changing Factor Order</a></li>
<li class="chapter" data-level="10.3" data-path="factors.html"><a href="factors.html#changing-factor-levels"><i class="fa fa-check"></i><b>10.3</b> Changing Factor Levels</a></li>
<li class="chapter" data-level="10.4" data-path="factors.html"><a href="factors.html#examples-in-context-3"><i class="fa fa-check"></i><b>10.4</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="strings.html"><a href="strings.html"><i class="fa fa-check"></i><b>11</b> Strings</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a></li>
<li><a href="https://bookdown.org" target="_blank">Built with Bookdown + RStudio</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Readings for MTH250 - Data Wrangling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="groupings" class="section level1" number="8">
<h1><span class="header-section-number">Module 8</span> Groupings</h1>
<p>In some instances data from individual observations need to be summarized by groupings of those observations. For example, you may want to compute the total number of COVID cases by county (across all months) for the data frame shown below.<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a></p>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 48 x 4
#R&gt;      County  Month Year  Cases
#R&gt;      &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
#R&gt;    1 Ashland Mar   2020      1
#R&gt;    2 Ashland Apr   2020      1
#R&gt;    3 Ashland May   2020      0
#R&gt;    4 Ashland Jun   2020      1
#R&gt;    5 Ashland Jul   2020     16
#R&gt;    6 Ashland Aug   2020     16
#R&gt;    7 Ashland Sep   2020     94
#R&gt;    8 Ashland Oct   2020    167
#R&gt;    9 Ashland Nov   2020    378
#R&gt;   10 Ashland Dec   2020    331
#R&gt;   # ... with 38 more rows</code></pre>
<p>How to summarize and wrangle data by groups is introduced in this module.</p>
<div id="declaring-groupings" class="section level2" number="8.1">
<h2><span class="header-section-number">8.1</span> Declaring Groupings</h2>
<p>Groups may be declared by including the grouping variable or variables in <code>group_by()</code>. For example the code below declares groupings based on levels in <code>County</code>.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb288-1"><a href="groupings.html#cb288-1" aria-hidden="true" tabindex="-1"></a>covid_byCO <span class="ot">&lt;-</span> covABD <span class="sc">%&gt;%</span></span>
<span id="cb288-2"><a href="groupings.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(County)</span>
<span id="cb288-3"><a href="groupings.html#cb288-3" aria-hidden="true" tabindex="-1"></a>covid_byCO</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 48 x 4
#R&gt;   # Groups:   County [3]
#R&gt;      County  Month Year  Cases
#R&gt;      &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
#R&gt;    1 Ashland Mar   2020      1
#R&gt;    2 Ashland Apr   2020      1
#R&gt;    3 Ashland May   2020      0
#R&gt;    4 Ashland Jun   2020      1
#R&gt;    5 Ashland Jul   2020     16
#R&gt;    6 Ashland Aug   2020     16
#R&gt;    7 Ashland Sep   2020     94
#R&gt;    8 Ashland Oct   2020    167
#R&gt;    9 Ashland Nov   2020    378
#R&gt;   10 Ashland Dec   2020    331
#R&gt;   # ... with 38 more rows</code></pre>
<p>Simply using <code>group_by()</code> will not produce any immediately noticeable difference in the data frame. For example, the only perceptible difference above is the addition of the “Groups: County[3]” line. Using <code>group_by()</code> only adds a grouping declaration to a data frame. How this is useful is demonstrated in the next sections.</p>
<p>There can be multiple levels of groupings. For example, the code below will group <code>Year</code> within <code>County</code>. Note that the subsequent variables are always nested within groups of previous variables.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb290-1"><a href="groupings.html#cb290-1" aria-hidden="true" tabindex="-1"></a>covid_byCOYR <span class="ot">&lt;-</span> covABD <span class="sc">%&gt;%</span></span>
<span id="cb290-2"><a href="groupings.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(County,Year)</span>
<span id="cb290-3"><a href="groupings.html#cb290-3" aria-hidden="true" tabindex="-1"></a>covid_byCOYR</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 48 x 4
#R&gt;   # Groups:   County, Year [6]
#R&gt;      County  Month Year  Cases
#R&gt;      &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
#R&gt;    1 Ashland Mar   2020      1
#R&gt;    2 Ashland Apr   2020      1
#R&gt;    3 Ashland May   2020      0
#R&gt;    4 Ashland Jun   2020      1
#R&gt;    5 Ashland Jul   2020     16
#R&gt;    6 Ashland Aug   2020     16
#R&gt;    7 Ashland Sep   2020     94
#R&gt;    8 Ashland Oct   2020    167
#R&gt;    9 Ashland Nov   2020    378
#R&gt;   10 Ashland Dec   2020    331
#R&gt;   # ... with 38 more rows</code></pre>
<p> </p>
</div>
<div id="summarizing-by-groups" class="section level2" number="8.2">
<h2><span class="header-section-number">8.2</span> Summarizing by Groups</h2>
<p>Adding groupings to a data frame becomes most useful when that data frame is submitted to <code>summarize()</code> to summarize results by groups. The <code>summarize()</code> function takes arguments that are a name for the summary set equal to a function that creates a summary. The summary function can be any function that returns a single numeric result (Table <a href="groupings.html#tab:SumFunctions">8.1</a>).</p>
<p> </p>
<table class=" lightable-classic lightable-hover" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto;">
<caption>
<span id="tab:SumFunctions">Table 8.1: </span>Common summary functions used in <code>summarize()</code>, especially with <code>group_by()</code>. Note that <code>x</code> generically represents a variable in the data frame and would be replaced with a specific variable name (see examples in main text).
</caption>
<thead>
<tr>
<th style="text-align:left;font-weight: bold;">
Function
</th>
<th style="text-align:left;font-weight: bold;">
Summary value returned
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>n()</code>
</td>
<td style="text-align:left;">
Number of observations<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>sum(!is.na(x))</code>
</td>
<td style="text-align:left;">
Count of non-missing values in <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>sum(x)</code>
</td>
<td style="text-align:left;">
Sum values in <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>mean(x)</code>
</td>
<td style="text-align:left;">
Mean (average) of values in <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>median(x)</code>
</td>
<td style="text-align:left;">
Median of values in <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>sd(x)</code>
</td>
<td style="text-align:left;">
Standard deviation of values in <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>IQR(x)</code>
</td>
<td style="text-align:left;">
Inter-quartile range of values in <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>max(x)</code>
</td>
<td style="text-align:left;">
Maximum value of <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>min(x)</code>
</td>
<td style="text-align:left;">
Minimum value of <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>quantile(x,p)</code>
</td>
<td style="text-align:left;">
100<span class="math inline">\(\times\)</span><code>p</code>% quantile of values in <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>first(x)</code>
</td>
<td style="text-align:left;">
Value of first observation of <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>last(x)</code>
</td>
<td style="text-align:left;">
Value of last observation of <code>x</code>
</td>
</tr>
<tr>
<td style="text-align:left;width: 2.0in; ">
<code>n_distinct(x)</code>
</td>
<td style="text-align:left;">
Number of distance (i.e., unique) values of <code>x</code>.
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>For example, the code below finds the sample size (i.e., number of months) and total number of cases of COVID by county (across all months) using the first “grouped” data frame created in Section <a href="groupings.html#declaring-groupings">8.1</a>.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb292-1"><a href="groupings.html#cb292-1" aria-hidden="true" tabindex="-1"></a>sum_covid_byCO <span class="ot">&lt;-</span> covid_byCO <span class="sc">%&gt;%</span></span>
<span id="cb292-2"><a href="groupings.html#cb292-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_mons=</span><span class="fu">n</span>(),</span>
<span id="cb292-3"><a href="groupings.html#cb292-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">num_cases=</span><span class="fu">sum</span>(Cases))</span>
<span id="cb292-4"><a href="groupings.html#cb292-4" aria-hidden="true" tabindex="-1"></a>sum_covid_byCO</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 3
#R&gt;     County   num_mons num_cases
#R&gt;     &lt;chr&gt;       &lt;int&gt;     &lt;dbl&gt;
#R&gt;   1 Ashland        16      1291
#R&gt;   2 Bayfield       16      1169
#R&gt;   3 Douglas        16      4166</code></pre>
<p>The results from applying <code>summarize()</code> to a “grouped” data frame is itself a data frame with the last level of grouping removed. In the example above, there was only one level of grouping (i.e., <code>County</code>) so the returned result was simply a data frame with the grouping removed. However, applying the same summaries to the data frame that had groupings by both <code>County</code> and <code>Year</code> returns a data frame with summaries by year within each county, with the returned data frame retaining the first grouping (i.e., by <code>County</code>) but not the last (i.e., by <code>Year</code>).</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb294-1"><a href="groupings.html#cb294-1" aria-hidden="true" tabindex="-1"></a>sum_covid_byCOYR <span class="ot">&lt;-</span> covid_byCOYR <span class="sc">%&gt;%</span></span>
<span id="cb294-2"><a href="groupings.html#cb294-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_mons=</span><span class="fu">n</span>(),</span>
<span id="cb294-3"><a href="groupings.html#cb294-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">num_cases=</span><span class="fu">sum</span>(Cases))</span>
<span id="cb294-4"><a href="groupings.html#cb294-4" aria-hidden="true" tabindex="-1"></a>sum_covid_byCOYR</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 6 x 4
#R&gt;   # Groups:   County [3]
#R&gt;     County   Year  num_mons num_cases
#R&gt;     &lt;chr&gt;    &lt;chr&gt;    &lt;int&gt;     &lt;dbl&gt;
#R&gt;   1 Ashland  2020        10      1005
#R&gt;   2 Ashland  2021         6       286
#R&gt;   3 Bayfield 2020        10       903
#R&gt;   4 Bayfield 2021         6       266
#R&gt;   5 Douglas  2020        10      3081
#R&gt;   6 Douglas  2021         6      1085</code></pre>
<p>Summarizing this summarized but still grouped data frame will then summarize the summarized data across the remaining groupings (i.e., by <code>County</code>).<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a> Note that these results are the same as when the summarization was just by <code>County</code> (i.e., compare <code>sum_covid_byCO</code> from above to <code>sum_covid_byCO1</code> below).</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb296-1"><a href="groupings.html#cb296-1" aria-hidden="true" tabindex="-1"></a>sum_covid_byCO1 <span class="ot">&lt;-</span> sum_covid_byCOYR <span class="sc">%&gt;%</span></span>
<span id="cb296-2"><a href="groupings.html#cb296-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_mons=</span><span class="fu">sum</span>(num_mons),</span>
<span id="cb296-3"><a href="groupings.html#cb296-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">num_cases=</span><span class="fu">sum</span>(num_cases))</span>
<span id="cb296-4"><a href="groupings.html#cb296-4" aria-hidden="true" tabindex="-1"></a>sum_covid_byCO1</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 3
#R&gt;     County   num_mons num_cases
#R&gt;     &lt;chr&gt;       &lt;int&gt;     &lt;dbl&gt;
#R&gt;   1 Ashland        16      1291
#R&gt;   2 Bayfield       16      1169
#R&gt;   3 Douglas        16      4166</code></pre>
<p> </p>
<p>Nested levels of groupings can be very powerful, but they should be used carefully. As a general rule, multi-level summarizations on multiple grouping variables only work properly for counts and sums. Multi-level summarizations are unlikely to give the desired results when using other summaries, such as the mean or standard deviation.</p>
<p>For example, consider this simple data frame called <code>trouble</code> with two grouping variables and a single measurement variable.</p>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 11 x 3
#R&gt;      group1 group2 value
#R&gt;      &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;
#R&gt;    1 A      z         10
#R&gt;    2 A      z          9
#R&gt;    3 A      y         10
#R&gt;    4 A      y         12
#R&gt;    5 A      y         13
#R&gt;    6 A      y         14
#R&gt;    7 A      y         55
#R&gt;    8 B      z         10
#R&gt;    9 B      z          9
#R&gt;   10 B      y         11
#R&gt;   11 B      y         55</code></pre>
<p>The code below computes the sample size, sum, and mean of <code>value</code> for the two groups defined by <code>group1</code>.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb299-1"><a href="groupings.html#cb299-1" aria-hidden="true" tabindex="-1"></a>sum_trouble_1 <span class="ot">&lt;-</span> trouble <span class="sc">%&gt;%</span></span>
<span id="cb299-2"><a href="groupings.html#cb299-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group1) <span class="sc">%&gt;%</span></span>
<span id="cb299-3"><a href="groupings.html#cb299-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb299-4"><a href="groupings.html#cb299-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum=</span><span class="fu">sum</span>(value),</span>
<span id="cb299-5"><a href="groupings.html#cb299-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mn=</span><span class="fu">mean</span>(value))</span>
<span id="cb299-6"><a href="groupings.html#cb299-6" aria-hidden="true" tabindex="-1"></a>sum_trouble_1</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2 x 4
#R&gt;     group1     n   sum    mn
#R&gt;     &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 A          7   123  17.6
#R&gt;   2 B          4    85  21.2</code></pre>
<p>The code below computes the same summaries for the four groups defined by <code>group2</code> nested within <code>group1</code>.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb301-1"><a href="groupings.html#cb301-1" aria-hidden="true" tabindex="-1"></a>sum_trouble_2 <span class="ot">&lt;-</span> trouble <span class="sc">%&gt;%</span></span>
<span id="cb301-2"><a href="groupings.html#cb301-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group1,group2) <span class="sc">%&gt;%</span></span>
<span id="cb301-3"><a href="groupings.html#cb301-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb301-4"><a href="groupings.html#cb301-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum=</span><span class="fu">sum</span>(value),</span>
<span id="cb301-5"><a href="groupings.html#cb301-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mn=</span><span class="fu">mean</span>(value))</span>
<span id="cb301-6"><a href="groupings.html#cb301-6" aria-hidden="true" tabindex="-1"></a>sum_trouble_2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 4 x 5
#R&gt;   # Groups:   group1 [2]
#R&gt;     group1 group2     n   sum    mn
#R&gt;     &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 A      y          5   104  20.8
#R&gt;   2 A      z          2    19   9.5
#R&gt;   3 B      y          2    66  33  
#R&gt;   4 B      z          2    19   9.5</code></pre>
<p>This last data frame is still grouped by <code>group1</code> so it is possible to use it to get summaries for the two groups defined by <code>group1</code>.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb303-1"><a href="groupings.html#cb303-1" aria-hidden="true" tabindex="-1"></a>sum_trouble_1A <span class="ot">&lt;-</span> sum_trouble_2 <span class="sc">%&gt;%</span></span>
<span id="cb303-2"><a href="groupings.html#cb303-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">sum</span>(n),</span>
<span id="cb303-3"><a href="groupings.html#cb303-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum=</span><span class="fu">sum</span>(sum),</span>
<span id="cb303-4"><a href="groupings.html#cb303-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mn=</span><span class="fu">mean</span>(mn))</span>
<span id="cb303-5"><a href="groupings.html#cb303-5" aria-hidden="true" tabindex="-1"></a>sum_trouble_1A</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2 x 4
#R&gt;     group1     n   sum    mn
#R&gt;     &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 A          7   123  15.2
#R&gt;   2 B          4    85  21.2</code></pre>
<p>A comparison of <code>sum_trouble_1</code> from further above to <code>sum_trouble_1A</code> here reveals that both means return identical results for both groups for the count of and sum of the values and the same mean for the “B” group. However the mean is different for the “A” group. The means for the “A” group differ between the two methods of summarization because there were different sample sizes among the groups of <code>group2</code> nested within the “A” group of <code>group1</code>. In other words, the mean for the “A” group was calculated as the mean of 20.8 and 19.5 without realizing that 20.8 came from five observations in the <code>y</code> group and 9.5 came from only two observations in the <code>z</code> group.<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a></p>
<p> </p>
<div id="handling-missing-values" class="section level3" number="8.2.1">
<h3><span class="header-section-number">8.2.1</span> Handling Missing Values</h3>
<p>Missing values are coded in R with <code>NA</code>. For example, this simple data frame called <code>trouble2</code> has three missing values in the <code>value</code> variable.</p>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 11 x 3
#R&gt;      group1 group2 value
#R&gt;      &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt;
#R&gt;    1 A      z         10
#R&gt;    2 A      z         NA
#R&gt;    3 A      y         10
#R&gt;    4 A      y         12
#R&gt;    5 A      y         13
#R&gt;    6 A      y         14
#R&gt;    7 A      y         55
#R&gt;    8 B      z         NA
#R&gt;    9 B      z          9
#R&gt;   10 B      y         NA
#R&gt;   11 B      y         55</code></pre>
<p>Most of the summary functions shown in Table <a href="groupings.html#tab:SumFunctions">8.1</a> will return <code>NA</code> if the variable being summarized contains any <code>NA</code>s. For example, the code below attempts to count the number of values in <code>value</code> and compute the mean and standard deviation of <code>value</code> for each group in <code>group1</code>.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb306-1"><a href="groupings.html#cb306-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> trouble2 <span class="sc">%&gt;%</span></span>
<span id="cb306-2"><a href="groupings.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group1) <span class="sc">%&gt;%</span></span>
<span id="cb306-3"><a href="groupings.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb306-4"><a href="groupings.html#cb306-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mn=</span><span class="fu">mean</span>(value),</span>
<span id="cb306-5"><a href="groupings.html#cb306-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd=</span><span class="fu">sd</span>(value))</span>
<span id="cb306-6"><a href="groupings.html#cb306-6" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2 x 4
#R&gt;     group1     n    mn    sd
#R&gt;     &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 A          7    NA    NA
#R&gt;   2 B          4    NA    NA</code></pre>
<p>There are at least two issues here. First, the count variable (<code>n</code>) suggests that there were 7 and 4 <em>valid</em> observations in the two groups, when in reality there is only 6 and 2. Second, the means and standard deviations could not be properly calculated because of the <code>NA</code>s in <code>value</code>.</p>
<p>The first issue of counting valid observations is addressed by using the <code>sum(!is.na(x))</code> code shown in Table <a href="groupings.html#tab:SumFunctions">8.1</a>. This code is a combination of two functions. The <code>is.na()</code> function returns <code>TRUE</code> if an element is an <code>NA</code> (and <code>FALSE</code> otherwise). The exclamation point in front of <code>is.na()</code> takes the complement of these values (i.e., <code>TRUE</code> becomes <code>FALSE</code> and vice versa) such that <code>!is.na()</code> returns <code>TRUE</code> if the element is <strong>not</strong> an <code>NA</code>. When logical values are given to <code>sum()</code> the <code>TRUE</code>s are converted to <code>1</code>s and the <code>FALSE</code>s to <code>0</code>s. Thus, the <code>sum()</code> of these logicals will return the number of <code>TRUE</code>s or, in this case, the number of elements that are <strong>not</strong> <code>NA</code>; i.e., the number of valid observations.</p>
<p>The second issue of the summary function returning <code>NA</code> if an <code>NA</code> exists in the variable is addressed by including <code>na.rm=TRUE</code> within the summary function. This argument serves to remove the <code>NA</code>s from the calculations and will, thus, return the summary of all non-missing elements.</p>
<p>Thus, the following code provides a better summary of the count, mean, and standard deviation of the <code>value</code> variable.</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb308-1"><a href="groupings.html#cb308-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> trouble2 <span class="sc">%&gt;%</span></span>
<span id="cb308-2"><a href="groupings.html#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group1) <span class="sc">%&gt;%</span></span>
<span id="cb308-3"><a href="groupings.html#cb308-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb308-4"><a href="groupings.html#cb308-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_valid=</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(value)),</span>
<span id="cb308-5"><a href="groupings.html#cb308-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mn=</span><span class="fu">mean</span>(value,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb308-6"><a href="groupings.html#cb308-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd=</span><span class="fu">sd</span>(value,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb308-7"><a href="groupings.html#cb308-7" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2 x 5
#R&gt;     group1     n n_valid    mn    sd
#R&gt;     &lt;chr&gt;  &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 A          7       6    19  17.7
#R&gt;   2 B          4       2    32  32.5</code></pre>
<p> </p>
</div>
</div>
<div id="wrangling-by-group" class="section level2" number="8.3">
<h2><span class="header-section-number">8.3</span> Wrangling by Group</h2>
<p>Groupings can also be used with other <code>dplyr</code> verbs. For example, consider this simple data frame called <code>grades</code> that has hypothetical exam scores for students in two sections of a course.</p>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 11 x 3
#R&gt;      last       section grade
#R&gt;      &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt;
#R&gt;    1 Boshwitz         1  87.2
#R&gt;    2 Lepal            1  56.9
#R&gt;    3 Smith            1  74.4
#R&gt;    4 Felix            1  92.5
#R&gt;    5 Seidel           1  88.2
#R&gt;    6 Phelps           2  71.2
#R&gt;    7 McLaughlin       2  88.4
#R&gt;    8 Robertson        2  56.5
#R&gt;    9 Jak              2  78.3
#R&gt;   10 Abel             2  67.6
#R&gt;   11 Bonham           2  80.3</code></pre>
<p>The code below uses <code>rank()</code> and <code>desc()</code> to create a new variable that is the rank of the student in the course based on their grade. The <code>desc()</code> function must be used here to assure that the student with the highest grade is given a rank of 1 (because <code>rank()</code> ranks in ascending order by default).</p>
<div class="sourceCode" id="cb311"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb311-1"><a href="groupings.html#cb311-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> grades <span class="sc">%&gt;%</span></span>
<span id="cb311-2"><a href="groupings.html#cb311-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rnk=</span><span class="fu">rank</span>(<span class="fu">desc</span>(grade))) <span class="sc">%&gt;%</span></span>
<span id="cb311-3"><a href="groupings.html#cb311-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(rnk)</span>
<span id="cb311-4"><a href="groupings.html#cb311-4" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 11 x 4
#R&gt;      last       section grade   rnk
#R&gt;      &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;    1 Felix            1  92.5     1
#R&gt;    2 McLaughlin       2  88.4     2
#R&gt;    3 Seidel           1  88.2     3
#R&gt;    4 Boshwitz         1  87.2     4
#R&gt;    5 Bonham           2  80.3     5
#R&gt;    6 Jak              2  78.3     6
#R&gt;    7 Smith            1  74.4     7
#R&gt;    8 Phelps           2  71.2     8
#R&gt;    9 Abel             2  67.6     9
#R&gt;   10 Lepal            1  56.9    10
#R&gt;   11 Robertson        2  56.5    11</code></pre>
<p>However, suppose that interest is in the rank WITHIN each section. Here <code>group_by()</code> can be used prior to <code>mutate()</code> so that the methods in <code>mutate()</code> are applied separately to each group.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb313-1"><a href="groupings.html#cb313-1" aria-hidden="true" tabindex="-1"></a>grades <span class="sc">%&lt;&gt;%</span></span>
<span id="cb313-2"><a href="groupings.html#cb313-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(section) <span class="sc">%&gt;%</span></span>
<span id="cb313-3"><a href="groupings.html#cb313-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">rnk=</span><span class="fu">rank</span>(<span class="fu">desc</span>(grade))) <span class="sc">%&gt;%</span></span>
<span id="cb313-4"><a href="groupings.html#cb313-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(section,rnk)</span>
<span id="cb313-5"><a href="groupings.html#cb313-5" aria-hidden="true" tabindex="-1"></a>grades</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 11 x 4
#R&gt;   # Groups:   section [2]
#R&gt;      last       section grade   rnk
#R&gt;      &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;    1 Felix            1  92.5     1
#R&gt;    2 Seidel           1  88.2     2
#R&gt;    3 Boshwitz         1  87.2     3
#R&gt;    4 Smith            1  74.4     4
#R&gt;    5 Lepal            1  56.9     5
#R&gt;    6 McLaughlin       2  88.4     1
#R&gt;    7 Bonham           2  80.3     2
#R&gt;    8 Jak              2  78.3     3
#R&gt;    9 Phelps           2  71.2     4
#R&gt;   10 Abel             2  67.6     5
#R&gt;   11 Robertson        2  56.5     6</code></pre>
<p>Note that in contrast to <code>summarize()</code> that the grouping is not removed from the data frame when <code>mutate()</code> is used.</p>
<p>Further suppose that the data frame should be reduced to the three students with the highest grades in EACH section. Here <code>filter()</code> can be used to filter the data within each grouping.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb315-1"><a href="groupings.html#cb315-1" aria-hidden="true" tabindex="-1"></a>top3 <span class="ot">&lt;-</span> grades <span class="sc">%&gt;%</span></span>
<span id="cb315-2"><a href="groupings.html#cb315-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(rnk<span class="sc">&lt;=</span><span class="dv">3</span>)</span>
<span id="cb315-3"><a href="groupings.html#cb315-3" aria-hidden="true" tabindex="-1"></a>top3</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 6 x 4
#R&gt;   # Groups:   section [2]
#R&gt;     last       section grade   rnk
#R&gt;     &lt;chr&gt;        &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 Felix            1  92.5     1
#R&gt;   2 Seidel           1  88.2     2
#R&gt;   3 Boshwitz         1  87.2     3
#R&gt;   4 McLaughlin       2  88.4     1
#R&gt;   5 Bonham           2  80.3     2
#R&gt;   6 Jak              2  78.3     3</code></pre>
<p>Once again, note that the grouping is not removed from the data frame when using <code>filter()</code>. Thus, one could immediately calculate the mean grade for the highest three grades in each section.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb317-1"><a href="groupings.html#cb317-1" aria-hidden="true" tabindex="-1"></a>top3 <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb317-2"><a href="groupings.html#cb317-2" aria-hidden="true" tabindex="-1"></a>                   <span class="at">mn=</span><span class="fu">mean</span>(grade))</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2 x 3
#R&gt;     section     n    mn
#R&gt;       &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt;
#R&gt;   1       1     3  89.3
#R&gt;   2       2     3  82.3</code></pre>
<p> </p>
<p>The use of <code>mutate()</code> with <code>group_by()</code> is less common but can be very powerful. As a simple example, suppose that one wanted to find the difference between each observation and the mean of its group. In the example below, the use of <code>mean()</code> within <code>mutate()</code> will find the mean for each group because of the use of <code>group_by()</code>. Because this is within a <code>mutate()</code> rather than a <code>summarize()</code> it is repeated for each observation in each group.</p>
<div class="sourceCode" id="cb319"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb319-1"><a href="groupings.html#cb319-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> trouble2 <span class="sc">%&gt;%</span></span>
<span id="cb319-2"><a href="groupings.html#cb319-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group1) <span class="sc">%&gt;%</span></span>
<span id="cb319-3"><a href="groupings.html#cb319-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mn=</span><span class="fu">mean</span>(value,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb319-4"><a href="groupings.html#cb319-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">diff=</span>value<span class="sc">-</span>mn)</span>
<span id="cb319-5"><a href="groupings.html#cb319-5" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 11 x 5
#R&gt;   # Groups:   group1 [2]
#R&gt;      group1 group2 value    mn  diff
#R&gt;      &lt;chr&gt;  &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;    1 A      z         10    19    -9
#R&gt;    2 A      z         NA    19    NA
#R&gt;    3 A      y         10    19    -9
#R&gt;    4 A      y         12    19    -7
#R&gt;    5 A      y         13    19    -6
#R&gt;    6 A      y         14    19    -5
#R&gt;    7 A      y         55    19    36
#R&gt;    8 B      z         NA    32    NA
#R&gt;    9 B      z          9    32   -23
#R&gt;   10 B      y         NA    32    NA
#R&gt;   11 B      y         55    32    23</code></pre>
<p> </p>
</div>
<div id="ungrouping" class="section level2" number="8.4">
<h2><span class="header-section-number">8.4</span> Ungrouping</h2>
<p>As a general rule-of-thumb it is best to remove the groupings from your data frame once you know you are done summarizing, filtering, etc. based on groups. There are two main reasons for this. First, as noted above, many <code>dplyr</code> verbs work on groupings. Thus, if your data frame maintins groupings after you are done (in your mind) with groupings then you may get unintended results.</p>
<p>As a very simple example, suppose that you want to use <code>slice()</code> to retain <strong>ONLY</strong> the first row of a data frame. However, if that data frame has groupings (e.g., after a first level of summarizing) then <code>slice()</code> will return rows from each group. For example, suppose that you want only the first row of <code>sum_trouble_2</code> created above (note below that it retained a grouping variable).</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb321-1"><a href="groupings.html#cb321-1" aria-hidden="true" tabindex="-1"></a>sum_trouble_2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 4 x 5
#R&gt;   # Groups:   group1 [2]
#R&gt;     group1 group2     n   sum    mn
#R&gt;     &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 A      y          5   104  20.8
#R&gt;   2 A      z          2    19   9.5
#R&gt;   3 B      y          2    66  33  
#R&gt;   4 B      z          2    19   9.5</code></pre>
<div class="sourceCode" id="cb323"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb323-1"><a href="groupings.html#cb323-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> sum_trouble_2 <span class="sc">%&gt;%</span></span>
<span id="cb323-2"><a href="groupings.html#cb323-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb323-3"><a href="groupings.html#cb323-3" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2 x 5
#R&gt;   # Groups:   group1 [2]
#R&gt;     group1 group2     n   sum    mn
#R&gt;     &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 A      y          5   104  20.8
#R&gt;   2 B      y          2    66  33</code></pre>
<p>As you can see, <code>slice()</code> was applied to both groups of <code>group1</code> such that the first row of each group was returned, which was not the intended outcome.</p>
<p>As another example, suppose that you wanted to change the names of the groups in <code>group1</code> in <code>sum_trouble_2</code>.</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb325-1"><a href="groupings.html#cb325-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> sum_trouble_2 <span class="sc">%&gt;%</span></span>
<span id="cb325-2"><a href="groupings.html#cb325-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group1=</span>plyr<span class="sc">::</span><span class="fu">mapvalues</span>(group1,<span class="at">from=</span><span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>),<span class="at">to=</span><span class="fu">c</span>(<span class="st">&quot;Alex&quot;</span>,<span class="st">&quot;Bart&quot;</span>)))</span></code></pre></div>
<pre class="RMESSAGE"><code>#R&gt;   The following `from` values were not present in `x`: B</code></pre>
<pre class="RMESSAGE"><code>#R&gt;   The following `from` values were not present in `x`: A</code></pre>
<div class="sourceCode" id="cb328"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb328-1"><a href="groupings.html#cb328-1" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 4 x 5
#R&gt;   # Groups:   group1 [2]
#R&gt;     group1 group2     n   sum    mn
#R&gt;     &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 Alex   y          5   104  20.8
#R&gt;   2 Alex   z          2    19   9.5
#R&gt;   3 Bart   y          2    66  33  
#R&gt;   4 Bart   z          2    19   9.5</code></pre>
<p>While this ultimately worked the messages shown in the output suggest an issue. Again the <code>mutate()</code> is applied by groups and when working with group “A” there is no group “B” which leads to the first message (and the second message comes from the opposite problem when working with group “B”).</p>
<p>Both of these issues can be corrected by using <code>ungroup()</code> to remove the groupings from the data frame.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb330-1"><a href="groupings.html#cb330-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> sum_trouble_2 <span class="sc">%&gt;%</span></span>
<span id="cb330-2"><a href="groupings.html#cb330-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb330-3"><a href="groupings.html#cb330-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">group1=</span>plyr<span class="sc">::</span><span class="fu">mapvalues</span>(group1,<span class="at">from=</span><span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>),<span class="at">to=</span><span class="fu">c</span>(<span class="st">&quot;Alex&quot;</span>,<span class="st">&quot;Bart&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb330-4"><a href="groupings.html#cb330-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="dv">1</span>)</span>
<span id="cb330-5"><a href="groupings.html#cb330-5" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 1 x 5
#R&gt;     group1 group2     n   sum    mn
#R&gt;     &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 Alex   y          5   104  20.8</code></pre>
<p>As a general rule-of-thumb, I suggest using <code>ungroup()</code> at the end of a piping chain where you know you are done with the groupings. For example, instead of using <code>ungroup()</code> as in the previous code, I would have created <code>sum_trouble_2</code> as such.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb332-1"><a href="groupings.html#cb332-1" aria-hidden="true" tabindex="-1"></a>sum_trouble_2 <span class="ot">&lt;-</span> trouble <span class="sc">%&gt;%</span></span>
<span id="cb332-2"><a href="groupings.html#cb332-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(group1,group2) <span class="sc">%&gt;%</span></span>
<span id="cb332-3"><a href="groupings.html#cb332-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb332-4"><a href="groupings.html#cb332-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sum=</span><span class="fu">sum</span>(value),</span>
<span id="cb332-5"><a href="groupings.html#cb332-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mn=</span><span class="fu">mean</span>(value)) <span class="sc">%&gt;%</span></span>
<span id="cb332-6"><a href="groupings.html#cb332-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb332-7"><a href="groupings.html#cb332-7" aria-hidden="true" tabindex="-1"></a>sum_trouble_2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 4 x 5
#R&gt;     group1 group2     n   sum    mn
#R&gt;     &lt;chr&gt;  &lt;chr&gt;  &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 A      y          5   104  20.8
#R&gt;   2 A      z          2    19   9.5
#R&gt;   3 B      y          2    66  33  
#R&gt;   4 B      z          2    19   9.5</code></pre>
<p>Notice how the tibble does not showing any grouping structure.</p>
<p> </p>
</div>
<div id="examples-in-context-1" class="section level2" number="8.5">
<h2><span class="header-section-number">8.5</span> Examples in Context</h2>
<div id="student-data-1" class="section level3" number="8.5.1">
<h3><span class="header-section-number">8.5.1</span> Student Data</h3>
<p>In Section <a href="relational-data.html#student-data">4.3.1</a> a data frame called <code>schedules2</code> was constructued that contained a student’s ID number with each course they were enrolled along with the course’s credits and instructor.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb334-1"><a href="groupings.html#cb334-1" aria-hidden="true" tabindex="-1"></a>schedules2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 20 x 4
#R&gt;      studentID course credits instructor
#R&gt;          &lt;dbl&gt; &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt;     
#R&gt;    1     34535 MTH107       4 Ogle      
#R&gt;    2     34535 BIO115       4 Johnson   
#R&gt;    3     34535 CHM110       4 Carlson   
#R&gt;    4     34535 IDS101       3 Goyke     
#R&gt;    5     45423 SCD110       3 Tochterman
#R&gt;    6     45423 PSY110       4 Sneyd     
#R&gt;    7     45423 MTH140       4 Jensen    
#R&gt;    8     45423 OED212       3 Andre     
#R&gt;    9     45423 IDS101       3 Goyke     
#R&gt;   10     73424 BIO234       4 Goyke     
#R&gt;   11     73424 CHM220       4 Robertson 
#R&gt;   12     73424 BIO370       4 Anich     
#R&gt;   13     73424 SCD110       3 Tochterman
#R&gt;   14     89874 SCD440       4 Foster    
#R&gt;   15     89874 PSY370       4 Sneyd     
#R&gt;   16     89874 IDS490       4 Hannickel 
#R&gt;   17     98222 SCD440       4 Foster    
#R&gt;   18     98222 SCD330       3 Tochterman
#R&gt;   19     98222 SOC480       4 Schanning 
#R&gt;   20     98222 ART220       3 Duffy</code></pre>
<p>Additionally, recall that there was a data frame called <code>personal</code> that contained personal information about each student (along with the ID).</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb336-1"><a href="groupings.html#cb336-1" aria-hidden="true" tabindex="-1"></a>personal</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;     studentID  first_nm    last_nm     hometown homestate
#R&gt;   1     34535   Rolando   Blackman      Windsor        MI
#R&gt;   2     45423 Catherine    Johnson Eden Prairie        MN
#R&gt;   3     73424     James Carmichael       Marion        IA
#R&gt;   4     89874    Rachel      Brown    Milwaukee        WI
#R&gt;   5     98222   Esteban      Perez      El Paso        TX</code></pre>
<p>In this example, suppose that the registrar wants to creat a database that has the number of courses and the total number of credits taken appended to the personal information for each student. Construction of this database begins by summarizing <code>schedules2</code> for each student.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb338-1"><a href="groupings.html#cb338-1" aria-hidden="true" tabindex="-1"></a>sum_crs <span class="ot">&lt;-</span> schedules2 <span class="sc">%&gt;%</span></span>
<span id="cb338-2"><a href="groupings.html#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(studentID) <span class="sc">%&gt;%</span></span>
<span id="cb338-3"><a href="groupings.html#cb338-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_courses=</span><span class="fu">n</span>(),</span>
<span id="cb338-4"><a href="groupings.html#cb338-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">num_credits=</span><span class="fu">sum</span>(credits))</span>
<span id="cb338-5"><a href="groupings.html#cb338-5" aria-hidden="true" tabindex="-1"></a>sum_crs</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 5 x 3
#R&gt;     studentID num_courses num_credits
#R&gt;         &lt;dbl&gt;       &lt;int&gt;       &lt;dbl&gt;
#R&gt;   1     34535           4          15
#R&gt;   2     45423           5          17
#R&gt;   3     73424           4          15
#R&gt;   4     89874           3          12
#R&gt;   5     98222           4          14</code></pre>
<p>These results can then be <code>left_join()</code>ed with <code>personal</code> to create the desired database.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb340-1"><a href="groupings.html#cb340-1" aria-hidden="true" tabindex="-1"></a>personal2 <span class="ot">&lt;-</span> personal <span class="sc">%&gt;%</span></span>
<span id="cb340-2"><a href="groupings.html#cb340-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(sum_crs,<span class="at">by=</span><span class="st">&quot;studentID&quot;</span>)</span>
<span id="cb340-3"><a href="groupings.html#cb340-3" aria-hidden="true" tabindex="-1"></a>personal2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;     studentID  first_nm    last_nm     hometown homestate num_courses num_credits
#R&gt;   1     34535   Rolando   Blackman      Windsor        MI           4          15
#R&gt;   2     45423 Catherine    Johnson Eden Prairie        MN           5          17
#R&gt;   3     73424     James Carmichael       Marion        IA           4          15
#R&gt;   4     89874    Rachel      Brown    Milwaukee        WI           3          12
#R&gt;   5     98222   Esteban      Perez      El Paso        TX           4          14</code></pre>
<p> </p>
</div>
<div id="resource-sampling-data" class="section level3" number="8.5.2">
<h3><span class="header-section-number">8.5.2</span> Resource Sampling Data</h3>
<p>In Section <a href="relational-data.html#resource-data">4.3.2</a> a data frame called <code>fishcatch</code> was created that had the species and number of that species caught in each of five nets. The date and lake where the net was set was also recorded.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb342-1"><a href="groupings.html#cb342-1" aria-hidden="true" tabindex="-1"></a>fishcatch</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;     net_num      lake     date          species number
#R&gt;   1       1     Eagle 3-Jul-21         Bluegill      7
#R&gt;   2       1     Eagle 3-Jul-21  Largemouth Bass      3
#R&gt;   3       2      Hart 3-Jul-21         Bluegill     19
#R&gt;   4       2      Hart 3-Jul-21  Largemouth Bass      2
#R&gt;   5       2      Hart 3-Jul-21 Bluntnose Minnow     56
#R&gt;   6       3      Hart 5-Jul-21             &lt;NA&gt;     NA
#R&gt;   7       4     Eagle 6-Jul-21         Bluegill      3
#R&gt;   8       4     Eagle 6-Jul-21  Largemouth Bass      6
#R&gt;   9       5 Millicent 6-Jul-21  Largemouth Bass      3</code></pre>
<p>Suppose a technician wants to summarize the number of species caught and the total catch (regardless of species) in each net. An examination of the data frame above reveals <code>NA</code>s for <code>species</code> and <code>number</code> for one of the nets that did not catch any fish. Because of this we cannot simply count the number of rows for each <code>net_num</code> to get the number of species. Instead this calculation will have to be treated as described for finding the valid number of observations. The total catch in each <code>net_num</code> can be found with <code>sum()</code> but it must include <code>na.rm=TRUE</code> to account for the missing data.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb344-1"><a href="groupings.html#cb344-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> fishcatch <span class="sc">%&gt;%</span></span>
<span id="cb344-2"><a href="groupings.html#cb344-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(net_num) <span class="sc">%&gt;%</span></span>
<span id="cb344-3"><a href="groupings.html#cb344-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_spec=</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(species)),</span>
<span id="cb344-4"><a href="groupings.html#cb344-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">ttl_catch=</span><span class="fu">sum</span>(number,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span>
<span id="cb344-5"><a href="groupings.html#cb344-5" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 5 x 3
#R&gt;     net_num num_spec ttl_catch
#R&gt;       &lt;dbl&gt;    &lt;int&gt;     &lt;dbl&gt;
#R&gt;   1       1        2        10
#R&gt;   2       2        3        77
#R&gt;   3       3        0         0
#R&gt;   4       4        2         9
#R&gt;   5       5        1         3</code></pre>
<p>The resulting data frame is missing the specific information (date and lake) for each <code>net_num</code>. A trick for including information that is specific (and thus repeated) to the grouping variable is to include those variables as grouping variables prior to the main grouping variable. For example, there is only one <code>net_num</code> per <code>lake</code> and <code>date</code> combination so including <code>lake</code> and <code>date</code> prior to <code>net_num</code> will not alter the results but will retain the <code>lake</code> and <code>date</code> values. If you use this trick, make sure to <code>ungroup()</code> after the summarization so there are no unintended consequences of adding the extra grouping variables.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb346-1"><a href="groupings.html#cb346-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> fishcatch <span class="sc">%&gt;%</span></span>
<span id="cb346-2"><a href="groupings.html#cb346-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(lake,date,net_num) <span class="sc">%&gt;%</span></span>
<span id="cb346-3"><a href="groupings.html#cb346-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">num_spec=</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(species)),</span>
<span id="cb346-4"><a href="groupings.html#cb346-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">ttl_catch=</span><span class="fu">sum</span>(number,<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb346-5"><a href="groupings.html#cb346-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb346-6"><a href="groupings.html#cb346-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(net_num) <span class="sc">%&gt;%</span></span>
<span id="cb346-7"><a href="groupings.html#cb346-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(net_num)</span>
<span id="cb346-8"><a href="groupings.html#cb346-8" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 5 x 5
#R&gt;     net_num lake      date     num_spec ttl_catch
#R&gt;       &lt;dbl&gt; &lt;chr&gt;     &lt;chr&gt;       &lt;int&gt;     &lt;dbl&gt;
#R&gt;   1       1 Eagle     3-Jul-21        2        10
#R&gt;   2       2 Hart      3-Jul-21        3        77
#R&gt;   3       3 Hart      5-Jul-21        0         0
#R&gt;   4       4 Eagle     6-Jul-21        2         9
#R&gt;   5       5 Millicent 6-Jul-21        1         3</code></pre>
<p> </p>
</div>
<div id="wolves-and-moose-of-isle-royale" class="section level3" number="8.5.3">
<h3><span class="header-section-number">8.5.3</span> Wolves and Moose of Isle Royale</h3>
<p>In Section <a href="wrangle-columns.html#columns-isle-royale">6.7.2</a> a data frame called <code>irmw2</code> was created that contained the number of wolves and moose, the winter air temperature, and whether or not an ice bridge to the mainland formed for each year from 1959-2012. In that module, an <code>era</code> variable was also created that categorized the years into “early,” “middle,” and “late” time periods.</p>
<p>Suppose that the researchers want to compute summary statistics for the number of moose separated by era, and by era and whether an ice bridge formed. The latter is accomplished below.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb348-1"><a href="groupings.html#cb348-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> irmw2 <span class="sc">%&gt;%</span></span>
<span id="cb348-2"><a href="groupings.html#cb348-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(era,ice_bridges) <span class="sc">%&gt;%</span></span>
<span id="cb348-3"><a href="groupings.html#cb348-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb348-4"><a href="groupings.html#cb348-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_valid=</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(moose)),</span>
<span id="cb348-5"><a href="groupings.html#cb348-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean=</span><span class="fu">mean</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb348-6"><a href="groupings.html#cb348-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd=</span><span class="fu">sd</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb348-7"><a href="groupings.html#cb348-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">min=</span><span class="fu">min</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb348-8"><a href="groupings.html#cb348-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">Q1=</span><span class="fu">quantile</span>(moose,<span class="fl">0.25</span>,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb348-9"><a href="groupings.html#cb348-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">median=</span><span class="fu">median</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb348-10"><a href="groupings.html#cb348-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Q3=</span><span class="fu">quantile</span>(moose,<span class="fl">0.75</span>,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb348-11"><a href="groupings.html#cb348-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">max=</span><span class="fu">max</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb348-12"><a href="groupings.html#cb348-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb348-13"><a href="groupings.html#cb348-13" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 6 x 11
#R&gt;     era    ice_bridges     n n_valid  mean    sd   min    Q1 median    Q3   max
#R&gt;     &lt;chr&gt;  &lt;chr&gt;       &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 early  no              4       4  734.  322.  538.  557.   592.  769. 1215.
#R&gt;   2 early  yes            12      12  864.  264.  572.  624.   807. 1079. 1243.
#R&gt;   3 middle no             17      17 1150.  381.  767.  925.  1031. 1260. 2117.
#R&gt;   4 middle yes             9       9 1277.  575.  780.  900.   976. 1496. 2398.
#R&gt;   5 recent no             14      14  816.  364.  385   519.   750  1069. 1600 
#R&gt;   6 recent yes             5       5 1297   523.  650  1050   1250  1475  2060</code></pre>
<p>Here I <code>ungroup()</code>ed the data frame because I want to make sure that I am not tempted to summarize the returned data frame that would have still had groupings by <code>era</code>. As mentioned in the main text it is inappropriate to compute most summaries on a second level of groupings after summarizing by the first level of groupings.</p>
<p>Thus, the first goal of the researchers is then accomplished below.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb350-1"><a href="groupings.html#cb350-1" aria-hidden="true" tabindex="-1"></a>tmp <span class="ot">&lt;-</span> irmw2 <span class="sc">%&gt;%</span></span>
<span id="cb350-2"><a href="groupings.html#cb350-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(era) <span class="sc">%&gt;%</span></span>
<span id="cb350-3"><a href="groupings.html#cb350-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb350-4"><a href="groupings.html#cb350-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">n_valid=</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(moose)),</span>
<span id="cb350-5"><a href="groupings.html#cb350-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean=</span><span class="fu">mean</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb350-6"><a href="groupings.html#cb350-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd=</span><span class="fu">sd</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb350-7"><a href="groupings.html#cb350-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">min=</span><span class="fu">min</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb350-8"><a href="groupings.html#cb350-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">Q1=</span><span class="fu">quantile</span>(moose,<span class="fl">0.25</span>,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb350-9"><a href="groupings.html#cb350-9" aria-hidden="true" tabindex="-1"></a>            <span class="at">median=</span><span class="fu">median</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb350-10"><a href="groupings.html#cb350-10" aria-hidden="true" tabindex="-1"></a>            <span class="at">Q3=</span><span class="fu">quantile</span>(moose,<span class="fl">0.75</span>,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb350-11"><a href="groupings.html#cb350-11" aria-hidden="true" tabindex="-1"></a>            <span class="at">max=</span><span class="fu">max</span>(moose,<span class="at">na.rm=</span><span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb350-12"><a href="groupings.html#cb350-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>()</span>
<span id="cb350-13"><a href="groupings.html#cb350-13" aria-hidden="true" tabindex="-1"></a>tmp</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 10
#R&gt;     era        n n_valid  mean    sd   min    Q1 median    Q3   max
#R&gt;     &lt;chr&gt;  &lt;int&gt;   &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 early     16      16  832.  274.  538.  592.   713. 1079. 1243.
#R&gt;   2 middle    26      26 1194.  450.  767.  906.  1023. 1301. 2398.
#R&gt;   3 recent    19      19  943.  452.  385   535    900  1185. 2060</code></pre>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="26">
<li id="fn26"><p>This data frame was introduced in Module <a href="pivot.html#pivot">5</a>.<a href="groupings.html#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p>There are no arguments to <code>n()</code>.<a href="groupings.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>Note here the use of the summarized but still grouped data frame and that the computation of numbers of months and cases had to be adjusted for the new variables in the summarized data frame.<a href="groupings.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>In the two-level summarize the mean of the “A” group is calculated as <span class="math inline">\(\frac{20.8+19.5}{1+1}\)</span> rather than <span class="math inline">\(\frac{104+19}{5+2}\)</span>.<a href="groupings.html#fnref29" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="wrangle-rows.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="dates-and-times.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
