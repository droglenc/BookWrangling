<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 9 Dates and Times | Readings for MTH250 - Data Wrangling</title>
  <meta name="description" content="This book contains the readings for MTH250W at Northland College." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 9 Dates and Times | Readings for MTH250 - Data Wrangling" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://derekogle.com/BookWrangling/" />
  
  <meta property="og:description" content="This book contains the readings for MTH250W at Northland College." />
  <meta name="github-repo" content="droglenc/BookWrangling" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 9 Dates and Times | Readings for MTH250 - Data Wrangling" />
  
  <meta name="twitter:description" content="This book contains the readings for MTH250W at Northland College." />
  

<meta name="author" content="Derek H. Ogle" />


<meta name="date" content="2021-08-05" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="groupings.html"/>
<link rel="next" href="strings.html"/>
<script src="libs/header-attrs-2.9/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Readings for Data Wrangling in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="preparation.html"><a href="preparation.html"><i class="fa fa-check"></i><b>1</b> Preparation</a></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Data Structures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#vectors"><i class="fa fa-check"></i><b>2.1</b> Vectors</a></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#data-classes"><i class="fa fa-check"></i><b>2.2</b> Data Classes</a></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#data-frames"><i class="fa fa-check"></i><b>2.3</b> Data Frames</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#tidy-data"><i class="fa fa-check"></i><b>2.4</b> Tidy Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="read-external-data-files.html"><a href="read-external-data-files.html"><i class="fa fa-check"></i><b>3</b> Read External Data Files</a>
<ul>
<li class="chapter" data-level="3.1" data-path="read-external-data-files.html"><a href="read-external-data-files.html#entering-data"><i class="fa fa-check"></i><b>3.1</b> Entering Data</a></li>
<li class="chapter" data-level="3.2" data-path="read-external-data-files.html"><a href="read-external-data-files.html#saving-the-external-file"><i class="fa fa-check"></i><b>3.2</b> Saving the External File</a></li>
<li class="chapter" data-level="3.3" data-path="read-external-data-files.html"><a href="read-external-data-files.html#reading-the-external-file"><i class="fa fa-check"></i><b>3.3</b> Reading the External File</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="relational-data.html"><a href="relational-data.html"><i class="fa fa-check"></i><b>4</b> Relational Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="relational-data.html"><a href="relational-data.html#join-concepts"><i class="fa fa-check"></i><b>4.1</b> Join Concepts</a></li>
<li class="chapter" data-level="4.2" data-path="relational-data.html"><a href="relational-data.html#joins-in-r"><i class="fa fa-check"></i><b>4.2</b> Joins in R</a></li>
<li class="chapter" data-level="4.3" data-path="relational-data.html"><a href="relational-data.html#examples-with-context"><i class="fa fa-check"></i><b>4.3</b> Examples With Context</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="pivot.html"><a href="pivot.html"><i class="fa fa-check"></i><b>5</b> Pivot</a>
<ul>
<li class="chapter" data-level="5.1" data-path="pivot.html"><a href="pivot.html#data-formats"><i class="fa fa-check"></i><b>5.1</b> Data Formats</a></li>
<li class="chapter" data-level="5.2" data-path="pivot.html"><a href="pivot.html#pivoting-concepts"><i class="fa fa-check"></i><b>5.2</b> Pivoting Concepts</a></li>
<li class="chapter" data-level="5.3" data-path="pivot.html"><a href="pivot.html#pivoting-in-r"><i class="fa fa-check"></i><b>5.3</b> Pivoting in R</a></li>
<li class="chapter" data-level="5.4" data-path="pivot.html"><a href="pivot.html#pivoting-examples"><i class="fa fa-check"></i><b>5.4</b> Examples with Context</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="wrangle-columns.html"><a href="wrangle-columns.html"><i class="fa fa-check"></i><b>6</b> Wrangle Columns</a>
<ul>
<li class="chapter" data-level="6.1" data-path="wrangle-columns.html"><a href="wrangle-columns.html#dplyr-verbs"><i class="fa fa-check"></i><b>6.1</b> <code>dplyr</code> verbs</a></li>
<li class="chapter" data-level="6.2" data-path="wrangle-columns.html"><a href="wrangle-columns.html#pipe"><i class="fa fa-check"></i><b>6.2</b> Pipe</a></li>
<li class="chapter" data-level="6.3" data-path="wrangle-columns.html"><a href="wrangle-columns.html#selecting-variables"><i class="fa fa-check"></i><b>6.3</b> Selecting Variables</a></li>
<li class="chapter" data-level="6.4" data-path="wrangle-columns.html"><a href="wrangle-columns.html#moving-variables"><i class="fa fa-check"></i><b>6.4</b> Moving Variables</a></li>
<li class="chapter" data-level="6.5" data-path="wrangle-columns.html"><a href="wrangle-columns.html#renaming-variables"><i class="fa fa-check"></i><b>6.5</b> Renaming Variables</a></li>
<li class="chapter" data-level="6.6" data-path="wrangle-columns.html"><a href="wrangle-columns.html#adding-variables"><i class="fa fa-check"></i><b>6.6</b> Adding Variables</a></li>
<li class="chapter" data-level="6.7" data-path="wrangle-columns.html"><a href="wrangle-columns.html#columns-examples"><i class="fa fa-check"></i><b>6.7</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wrangle-rows.html"><a href="wrangle-rows.html"><i class="fa fa-check"></i><b>7</b> Wrangle Rows</a>
<ul>
<li class="chapter" data-level="7.1" data-path="wrangle-rows.html"><a href="wrangle-rows.html#filtering-rows"><i class="fa fa-check"></i><b>7.1</b> Filtering Rows</a></li>
<li class="chapter" data-level="7.2" data-path="wrangle-rows.html"><a href="wrangle-rows.html#arranging-rows"><i class="fa fa-check"></i><b>7.2</b> Arranging Rows</a></li>
<li class="chapter" data-level="7.3" data-path="wrangle-rows.html"><a href="wrangle-rows.html#appending-rows"><i class="fa fa-check"></i><b>7.3</b> Appending Rows</a></li>
<li class="chapter" data-level="7.4" data-path="wrangle-rows.html"><a href="wrangle-rows.html#examples-in-context"><i class="fa fa-check"></i><b>7.4</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="groupings.html"><a href="groupings.html"><i class="fa fa-check"></i><b>8</b> Groupings</a></li>
<li class="chapter" data-level="9" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>9</b> Dates and Times</a>
<ul>
<li class="chapter" data-level="9.1" data-path="dates-and-times.html"><a href="dates-and-times.html#obtaining-dates-data"><i class="fa fa-check"></i><b>9.1</b> Obtaining Dates Data</a></li>
<li class="chapter" data-level="9.2" data-path="dates-and-times.html"><a href="dates-and-times.html#extracting-date-components"><i class="fa fa-check"></i><b>9.2</b> Extracting Date Components</a></li>
<li class="chapter" data-level="9.3" data-path="dates-and-times.html"><a href="dates-and-times.html#calculations-with-dates"><i class="fa fa-check"></i><b>9.3</b> Calculations with Dates</a></li>
<li class="chapter" data-level="9.4" data-path="dates-and-times.html"><a href="dates-and-times.html#obtaining-time-data"><i class="fa fa-check"></i><b>9.4</b> Obtaining Time Data</a></li>
<li class="chapter" data-level="9.5" data-path="dates-and-times.html"><a href="dates-and-times.html#extracting-time-components"><i class="fa fa-check"></i><b>9.5</b> Extracting Time Components</a></li>
<li class="chapter" data-level="9.6" data-path="dates-and-times.html"><a href="dates-and-times.html#calculations-with-date-times"><i class="fa fa-check"></i><b>9.6</b> Calculations with Date-Times</a></li>
<li class="chapter" data-level="9.7" data-path="dates-and-times.html"><a href="dates-and-times.html#examples-in-context-1"><i class="fa fa-check"></i><b>9.7</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="strings.html"><a href="strings.html"><i class="fa fa-check"></i><b>10</b> Strings</a></li>
<li class="chapter" data-level="11" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>11</b> Factors</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a></li>
<li><a href="https://bookdown.org" target="_blank">Built with Bookdown + RStudio</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Readings for MTH250 - Data Wrangling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dates-and-times" class="section level1" number="9">
<h1><span class="header-section-number">Module 9</span> Dates and Times</h1>
<p>One of the most common and most difficult types of data to wrangle is date, time, or date and time data. Dates, for example, can be entered in a variety of formats (with different “standards” for different parts of the world) and there are different numbers of days in months, leap years, and starts of the week. Times have complications related to, for example, different formats (e.g., 12- versue 24-hour clock) and time zones. The most common (rather than all) difficulties with dates and times will be addressed in this module.</p>
<p>The methods in this module depend on functions from <code>lubridate</code>, which must be explicitly loaded as it is not part of <code>tidyverse</code>.<a href="#fn26" class="footnote-ref" id="fnref26"><sup>26</sup></a></p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb287-1"><a href="dates-and-times.html#cb287-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span></code></pre></div>
<p> </p>
<div id="obtaining-dates-data" class="section level2" number="9.1">
<h2><span class="header-section-number">9.1</span> Obtaining Dates Data</h2>
<div id="making-dates-from-strings" class="section level3" number="9.1.1">
<h3><span class="header-section-number">9.1.1</span> Making Dates from Strings</h3>
<p>Dates are often entered as string or character class data, which can make them fairly easily to deal with. However, dates can be entered in many different formats, some of which can be ambiguous as to what date they represent. For example, July 15th in 2021 could be formatted as “July 15, 2021,” “15-Jul-2021,” “15-Jul-21,” “15-July-2021,” or “2021-Jul-15,” among other possibilities. Fortunately, <code>lubridate</code> has a suite of functions that can easily convert strings to dates as long as all dates are entered in the same format and you know what that format is.</p>
<p>The <code>lubridate</code> function names are combinations of <code>y</code>, <code>m</code>, and <code>d</code> in order of the year, month, and day components of the date format. For example, if dates are given as year, month, and day then use <code>ymd()</code>. Alternatively, if dates are given as month, day, and year then use <code>mdy()</code>.</p>
<p>Each <code>lubridate</code> function is good at deciphering the proper dates regardless of how the components are separated (dashes, slashes, commas, spaces) or whether words or numbers are used for months. For example, a data frame is created below that has dates in year-month-day format in the <code>DSTR</code> variable which is then converted with <code>ymd()</code> to the <code>DATE</code> variable. Note how the <code>DATE</code> variable is of the “date” data class, which is what is needed for proper graphing and calculation as shown in later sections.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb288-1"><a href="dates-and-times.html#cb288-1" aria-hidden="true" tabindex="-1"></a>ex1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">DSTR=</span><span class="fu">c</span>(<span class="st">&quot;2021-7-15&quot;</span>,<span class="st">&quot;2020-9-21&quot;</span>,<span class="st">&quot;2019-3-3&quot;</span>),</span>
<span id="cb288-2"><a href="dates-and-times.html#cb288-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">DATE=</span><span class="fu">ymd</span>(DSTR))</span>
<span id="cb288-3"><a href="dates-and-times.html#cb288-3" aria-hidden="true" tabindex="-1"></a>ex1</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 2
#R&gt;     DSTR      DATE      
#R&gt;     &lt;chr&gt;     &lt;date&gt;    
#R&gt;   1 2021-7-15 2021-07-15
#R&gt;   2 2020-9-21 2020-09-21
#R&gt;   3 2019-3-3  2019-03-03</code></pre>
<p>The following examples are similar except that the date strings are in different formats so different <code>lubridate</code> functions are used. Note how the <code>DATE</code> variable in each example has the same year-month-day format. Thus, regardless of the original format of the date, the “date” class variable will be the same format.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb290-1"><a href="dates-and-times.html#cb290-1" aria-hidden="true" tabindex="-1"></a>ex2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">DSTR=</span><span class="fu">c</span>(<span class="st">&quot;July 15, 2021&quot;</span>,<span class="st">&quot;September 11, 2020&quot;</span>,<span class="st">&quot;March 3, 2019&quot;</span>),</span>
<span id="cb290-2"><a href="dates-and-times.html#cb290-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">DATE=</span><span class="fu">mdy</span>(DSTR))</span>
<span id="cb290-3"><a href="dates-and-times.html#cb290-3" aria-hidden="true" tabindex="-1"></a>ex2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 2
#R&gt;     DSTR               DATE      
#R&gt;     &lt;chr&gt;              &lt;date&gt;    
#R&gt;   1 July 15, 2021      2021-07-15
#R&gt;   2 September 11, 2020 2020-09-11
#R&gt;   3 March 3, 2019      2019-03-03</code></pre>
<div class="sourceCode" id="cb292"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb292-1"><a href="dates-and-times.html#cb292-1" aria-hidden="true" tabindex="-1"></a>ex3 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">DSTR=</span><span class="fu">c</span>(<span class="st">&quot;Jul-15, 2021&quot;</span>,<span class="st">&quot;Sep-11, 2020&quot;</span>,<span class="st">&quot;Mar-3, 2019&quot;</span>),</span>
<span id="cb292-2"><a href="dates-and-times.html#cb292-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">DATE=</span><span class="fu">mdy</span>(DSTR))</span>
<span id="cb292-3"><a href="dates-and-times.html#cb292-3" aria-hidden="true" tabindex="-1"></a>ex3</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 2
#R&gt;     DSTR         DATE      
#R&gt;     &lt;chr&gt;        &lt;date&gt;    
#R&gt;   1 Jul-15, 2021 2021-07-15
#R&gt;   2 Sep-11, 2020 2020-09-11
#R&gt;   3 Mar-3, 2019  2019-03-03</code></pre>
<div class="sourceCode" id="cb294"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb294-1"><a href="dates-and-times.html#cb294-1" aria-hidden="true" tabindex="-1"></a>ex4 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">DSTR=</span><span class="fu">c</span>(<span class="st">&quot;7/15/2021&quot;</span>,<span class="st">&quot;9/11/2020&quot;</span>,<span class="st">&quot;3/3/2019&quot;</span>),</span>
<span id="cb294-2"><a href="dates-and-times.html#cb294-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">DATE=</span><span class="fu">mdy</span>(DSTR))</span>
<span id="cb294-3"><a href="dates-and-times.html#cb294-3" aria-hidden="true" tabindex="-1"></a>ex4</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 2
#R&gt;     DSTR      DATE      
#R&gt;     &lt;chr&gt;     &lt;date&gt;    
#R&gt;   1 7/15/2021 2021-07-15
#R&gt;   2 9/11/2020 2020-09-11
#R&gt;   3 3/3/2019  2019-03-03</code></pre>
<div class="sourceCode" id="cb296"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb296-1"><a href="dates-and-times.html#cb296-1" aria-hidden="true" tabindex="-1"></a>ex5 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">DSTR=</span><span class="fu">c</span>(<span class="st">&quot;15-Jul 2021&quot;</span>,<span class="st">&quot;11-Sep 2020&quot;</span>,<span class="st">&quot;3-Mar 2019&quot;</span>),</span>
<span id="cb296-2"><a href="dates-and-times.html#cb296-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">DATE=</span><span class="fu">dmy</span>(DSTR))</span>
<span id="cb296-3"><a href="dates-and-times.html#cb296-3" aria-hidden="true" tabindex="-1"></a>ex5</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 2
#R&gt;     DSTR        DATE      
#R&gt;     &lt;chr&gt;       &lt;date&gt;    
#R&gt;   1 15-Jul 2021 2021-07-15
#R&gt;   2 11-Sep 2020 2020-09-11
#R&gt;   3 3-Mar 2019  2019-03-03</code></pre>
<p> </p>
</div>
<div id="making-dates-from-components" class="section level3" number="9.1.2">
<h3><span class="header-section-number">9.1.2</span> Making Dates from Components</h3>
<p>It is also common to need to created dates from three separate variables that contain the year, month, and day components of the date, respectively.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb298-1"><a href="dates-and-times.html#cb298-1" aria-hidden="true" tabindex="-1"></a>ex6 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">yr=</span><span class="fu">c</span>(<span class="dv">2021</span>,<span class="dv">2020</span>,<span class="dv">2019</span>),</span>
<span id="cb298-2"><a href="dates-and-times.html#cb298-2" aria-hidden="true" tabindex="-1"></a>              <span class="at">mon=</span><span class="fu">c</span>(<span class="st">&quot;Jul&quot;</span>,<span class="st">&quot;Sep&quot;</span>,<span class="st">&quot;Mar&quot;</span>),</span>
<span id="cb298-3"><a href="dates-and-times.html#cb298-3" aria-hidden="true" tabindex="-1"></a>              <span class="at">d=</span><span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">11</span>,<span class="dv">3</span>))</span>
<span id="cb298-4"><a href="dates-and-times.html#cb298-4" aria-hidden="true" tabindex="-1"></a>ex6</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 3
#R&gt;        yr mon       d
#R&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt;
#R&gt;   1  2021 Jul      15
#R&gt;   2  2020 Sep      11
#R&gt;   3  2019 Mar       3</code></pre>
<p>An easy way to deal with these date components is to first combine them into a string with <code>paste()</code>.</p>
<div class="sourceCode" id="cb300"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb300-1"><a href="dates-and-times.html#cb300-1" aria-hidden="true" tabindex="-1"></a>ex6a <span class="ot">&lt;-</span> ex6 <span class="sc">%&gt;%</span></span>
<span id="cb300-2"><a href="dates-and-times.html#cb300-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DSTR=</span><span class="fu">paste</span>(mon,d,yr))</span>
<span id="cb300-3"><a href="dates-and-times.html#cb300-3" aria-hidden="true" tabindex="-1"></a>ex6a</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 4
#R&gt;        yr mon       d DSTR       
#R&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;      
#R&gt;   1  2021 Jul      15 Jul 15 2021
#R&gt;   2  2020 Sep      11 Sep 11 2020
#R&gt;   3  2019 Mar       3 Mar 3 2019</code></pre>
<p>The “date” class variable is then created with <code>mdy()</code> (in this case because of the order in which the components were pasted).</p>
<div class="sourceCode" id="cb302"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb302-1"><a href="dates-and-times.html#cb302-1" aria-hidden="true" tabindex="-1"></a>ex6a <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">DATE=</span><span class="fu">mdy</span>(DSTR))</span>
<span id="cb302-2"><a href="dates-and-times.html#cb302-2" aria-hidden="true" tabindex="-1"></a>ex6a</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 5
#R&gt;        yr mon       d DSTR        DATE      
#R&gt;     &lt;dbl&gt; &lt;chr&gt; &lt;dbl&gt; &lt;chr&gt;       &lt;date&gt;    
#R&gt;   1  2021 Jul      15 Jul 15 2021 2021-07-15
#R&gt;   2  2020 Sep      11 Sep 11 2020 2020-09-11
#R&gt;   3  2019 Mar       3 Mar 3 2019  2019-03-03</code></pre>
<p>The <code>paste()</code> is often used inside of <code>mdy()</code> to eliminate the need to create the intermediate <code>DSTR</code> variable. This is shown below, along with eliminating the original component variables to make a cleaner data frame to use in the next sections.</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb304-1"><a href="dates-and-times.html#cb304-1" aria-hidden="true" tabindex="-1"></a>ex6a <span class="ot">&lt;-</span> ex6 <span class="sc">%&gt;%</span></span>
<span id="cb304-2"><a href="dates-and-times.html#cb304-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATE=</span><span class="fu">mdy</span>(<span class="fu">paste</span>(mon,d,yr))) <span class="sc">%&gt;%</span></span>
<span id="cb304-3"><a href="dates-and-times.html#cb304-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(DATE)</span>
<span id="cb304-4"><a href="dates-and-times.html#cb304-4" aria-hidden="true" tabindex="-1"></a>ex6a</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 1
#R&gt;     DATE      
#R&gt;     &lt;date&gt;    
#R&gt;   1 2021-07-15
#R&gt;   2 2020-09-11
#R&gt;   3 2019-03-03</code></pre>
<p> </p>
</div>
</div>
<div id="extracting-date-components" class="section level2" number="9.2">
<h2><span class="header-section-number">9.2</span> Extracting Date Components</h2>
<p>The year, month, and day (within the month) can be extracted from a “date” class variable with <code>year()</code>, <code>month()</code>, and <code>day()</code>, respectively. The numeric month is extracted by <code>month()</code> by default. The abbreviated month will be returned if <code>label=TRUE</code> is used and the full month name is returned by also including <code>abbr=FALSE</code>.</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb306-1"><a href="dates-and-times.html#cb306-1" aria-hidden="true" tabindex="-1"></a>ex6b <span class="ot">&lt;-</span> ex6a <span class="sc">%&gt;%</span></span>
<span id="cb306-2"><a href="dates-and-times.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yr=</span><span class="fu">year</span>(DATE),</span>
<span id="cb306-3"><a href="dates-and-times.html#cb306-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">mon=</span><span class="fu">month</span>(DATE),</span>
<span id="cb306-4"><a href="dates-and-times.html#cb306-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">mon1=</span><span class="fu">month</span>(DATE,<span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb306-5"><a href="dates-and-times.html#cb306-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">mon2=</span><span class="fu">month</span>(DATE,<span class="at">label=</span><span class="cn">TRUE</span>,<span class="at">abbr=</span><span class="cn">FALSE</span>),</span>
<span id="cb306-6"><a href="dates-and-times.html#cb306-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">d=</span><span class="fu">day</span>(DATE))</span>
<span id="cb306-7"><a href="dates-and-times.html#cb306-7" aria-hidden="true" tabindex="-1"></a>ex6b</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 6
#R&gt;     DATE          yr   mon mon1  mon2          d
#R&gt;     &lt;date&gt;     &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt; &lt;ord&gt;     &lt;int&gt;
#R&gt;   1 2021-07-15  2021     7 Jul   July         15
#R&gt;   2 2020-09-11  2020     9 Sep   September    11
#R&gt;   3 2019-03-03  2019     3 Mar   March         3</code></pre>
<p>Note that the two variables of month names are of the “ord” class, which means that the natural order of the months is maintained. This is useful for graphing and for making comparisons. For example,</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb308-1"><a href="dates-and-times.html#cb308-1" aria-hidden="true" tabindex="-1"></a>ex6b<span class="sc">$</span>mon1 <span class="sc">&gt;</span> <span class="st">&quot;Apr&quot;</span></span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1]  TRUE  TRUE FALSE</code></pre>
<p>There are other useful extractor functions in <code>lubridate</code>. Day number within the year is returned with <code>yday()</code>.<a href="#fn27" class="footnote-ref" id="fnref27"><sup>27</sup></a></p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb310-1"><a href="dates-and-times.html#cb310-1" aria-hidden="true" tabindex="-1"></a><span class="fu">yday</span>(ex6a<span class="sc">$</span>DATE)</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] 196 255  62</code></pre>
<p>Numeric day of the week is returned by <code>wday()</code>.<a href="#fn28" class="footnote-ref" id="fnref28"><sup>28</sup></a> The abbreviated name of the week is returned when <code>label=TRUE</code> is included and the full names is returned when <code>abbr=FALSE</code> is also included. The data type will also be “ord” when labels are returned.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb312-1"><a href="dates-and-times.html#cb312-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(ex6a<span class="sc">$</span>DATE)</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] 5 6 1</code></pre>
<div class="sourceCode" id="cb314"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb314-1"><a href="dates-and-times.html#cb314-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(ex6a<span class="sc">$</span>DATE,<span class="at">label=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] Thu Fri Sun
#R&gt;   Levels: Sun &lt; Mon &lt; Tue &lt; Wed &lt; Thu &lt; Fri &lt; Sat</code></pre>
<div class="sourceCode" id="cb316"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb316-1"><a href="dates-and-times.html#cb316-1" aria-hidden="true" tabindex="-1"></a><span class="fu">wday</span>(ex6a<span class="sc">$</span>DATE,<span class="at">label=</span><span class="cn">TRUE</span>,<span class="at">abbr=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] Thursday Friday   Sunday  
#R&gt;   7 Levels: Sunday &lt; Monday &lt; Tuesday &lt; Wednesday &lt; Thursday &lt; ... &lt; Saturday</code></pre>
<p>Week number within the year is returned with <code>week()</code>.<a href="#fn29" class="footnote-ref" id="fnref29"><sup>29</sup></a></p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb318-1"><a href="dates-and-times.html#cb318-1" aria-hidden="true" tabindex="-1"></a><span class="fu">week</span>(ex6a<span class="sc">$</span>DATE)</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] 28 37  9</code></pre>
<p>Numeric day within a “quarter” is returned by <code>qday()</code>, whereas the actual “quarter” in which the day falls is returned by <code>quarter()</code>.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb320-1"><a href="dates-and-times.html#cb320-1" aria-hidden="true" tabindex="-1"></a><span class="fu">quarter</span>(ex6a<span class="sc">$</span>DATE)</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] 3 3 1</code></pre>
<div class="sourceCode" id="cb322"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb322-1"><a href="dates-and-times.html#cb322-1" aria-hidden="true" tabindex="-1"></a><span class="fu">qday</span>(ex6a<span class="sc">$</span>DATE)</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] 15 73 62</code></pre>
<p>Whether or not a year is a leap year can be determined with <code>leap_year()</code>.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb324-1"><a href="dates-and-times.html#cb324-1" aria-hidden="true" tabindex="-1"></a><span class="fu">leap_year</span>(<span class="dv">2010</span><span class="sc">:</span><span class="dv">2020</span>)</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;    [1] FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE</code></pre>
<p>Finally, the current date is found with <code>today()</code>.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb326-1"><a href="dates-and-times.html#cb326-1" aria-hidden="true" tabindex="-1"></a><span class="fu">today</span>()</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] &quot;2021-08-05&quot;</code></pre>
<p> </p>
</div>
<div id="calculations-with-dates" class="section level2" number="9.3">
<h2><span class="header-section-number">9.3</span> Calculations with Dates</h2>
<p>Performing calculations on dates introduces new data classes. The main one that we will use in this course is <strong>interval</strong>. An interval is a special date class that records the start and end date of an interval of time. Intervals are created from two dates with <code>%--%</code>. For example, the code below creates one interval from that date in <code>DATE</code> to today’s date and another constant interval from January 1, 2019 to January 1, 2021. Note in the second example that the date strings must be converted to a date format first (using <code>ymd()</code> in this case).</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb328-1"><a href="dates-and-times.html#cb328-1" aria-hidden="true" tabindex="-1"></a>ex6c <span class="ot">&lt;-</span> ex6a <span class="sc">%&gt;%</span></span>
<span id="cb328-2"><a href="dates-and-times.html#cb328-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">int2now=</span>DATE <span class="sc">%--%</span> <span class="fu">today</span>(),</span>
<span id="cb328-3"><a href="dates-and-times.html#cb328-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">int2Jan20=</span><span class="fu">ymd</span>(<span class="st">&quot;2019-Jan-1&quot;</span>) <span class="sc">%--%</span> <span class="fu">ymd</span>(<span class="st">&quot;2021-Jan-1&quot;</span>))</span>
<span id="cb328-4"><a href="dates-and-times.html#cb328-4" aria-hidden="true" tabindex="-1"></a>ex6c</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 3
#R&gt;     DATE       int2now                        int2Jan20                     
#R&gt;     &lt;date&gt;     &lt;Interval&gt;                     &lt;Interval&gt;                    
#R&gt;   1 2021-07-15 2021-07-15 UTC--2021-08-05 UTC 2019-01-01 UTC--2021-01-01 UTC
#R&gt;   2 2020-09-11 2020-09-11 UTC--2021-08-05 UTC 2019-01-01 UTC--2021-01-01 UTC
#R&gt;   3 2019-03-03 2019-03-03 UTC--2021-08-05 UTC 2019-01-01 UTC--2021-01-01 UTC</code></pre>
<p>Here you can see that the two new variables contain start and end dates for the interval on either side of the <code>--</code>.</p>
<p>Use <code>%within%</code> to determine if a date is within an interval and <code>int_overlaps()</code> to determine if two intervals overlap.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb330-1"><a href="dates-and-times.html#cb330-1" aria-hidden="true" tabindex="-1"></a><span class="fu">ymd</span>(<span class="st">&quot;2020-Jan-1&quot;</span>) <span class="sc">%within%</span> ex6c<span class="sc">$</span>int2now</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] FALSE FALSE  TRUE</code></pre>
<div class="sourceCode" id="cb332"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb332-1"><a href="dates-and-times.html#cb332-1" aria-hidden="true" tabindex="-1"></a><span class="fu">int_overlaps</span>(ex6c<span class="sc">$</span>int2now,ex6c<span class="sc">$</span>int2Jan20)</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] FALSE  TRUE  TRUE</code></pre>
<p>The amount of time within an interval is found with <code>time_length()</code> with units of measurement supplied to <code>unit=</code>. When <code>units=</code> <code>"months"</code> or <code>"years"</code> then <code>time_length()</code> will take into account that not all months and years have the same number of days.<a href="#fn30" class="footnote-ref" id="fnref30"><sup>30</sup></a></p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb334-1"><a href="dates-and-times.html#cb334-1" aria-hidden="true" tabindex="-1"></a>ex6d <span class="ot">&lt;-</span> ex6a <span class="sc">%&gt;%</span></span>
<span id="cb334-2"><a href="dates-and-times.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">int2now=</span>ex1<span class="sc">$</span>DATE <span class="sc">%--%</span> <span class="fu">today</span>(),</span>
<span id="cb334-3"><a href="dates-and-times.html#cb334-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">dur2now_days=</span><span class="fu">time_length</span>(int2now,<span class="at">unit=</span><span class="st">&quot;days&quot;</span>),</span>
<span id="cb334-4"><a href="dates-and-times.html#cb334-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">dur2now_yrs=</span><span class="fu">time_length</span>(int2now,<span class="at">unit=</span><span class="st">&quot;years&quot;</span>),</span>
<span id="cb334-5"><a href="dates-and-times.html#cb334-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">dur2now_mons=</span><span class="fu">time_length</span>(int2now,<span class="at">unit=</span><span class="st">&quot;months&quot;</span>))</span>
<span id="cb334-6"><a href="dates-and-times.html#cb334-6" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(ex6d,<span class="sc">-</span>DATE)  <span class="co"># only so that the new variables can be seen</span></span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 4
#R&gt;     int2now                        dur2now_days dur2now_yrs dur2now_mons
#R&gt;     &lt;Interval&gt;                            &lt;dbl&gt;       &lt;dbl&gt;        &lt;dbl&gt;
#R&gt;   1 2021-07-15 UTC--2021-08-05 UTC           21      0.0575        0.677
#R&gt;   2 2020-09-21 UTC--2021-08-05 UTC          318      0.871        10.5  
#R&gt;   3 2019-03-03 UTC--2021-08-05 UTC          886      2.42         29.1</code></pre>
<p> </p>
</div>
<div id="obtaining-time-data" class="section level2" number="9.4">
<h2><span class="header-section-number">9.4</span> Obtaining Time Data</h2>
<div id="just-times" class="section level3" number="9.4.1">
<h3><span class="header-section-number">9.4.1</span> Just Times</h3>
<p>One can work with just time in R, but I find it easier to append a constant “dummy date” to the times and then work with date-time objects. For example, suppose that the data frame below with just times (as a character variable) exists.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb336-1"><a href="dates-and-times.html#cb336-1" aria-hidden="true" tabindex="-1"></a>exT1 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">TSTR=</span><span class="fu">c</span>(<span class="st">&quot;12:15:01&quot;</span>,<span class="st">&quot;9:14:56&quot;</span>,<span class="st">&quot;19:34:01&quot;</span>))</span>
<span id="cb336-2"><a href="dates-and-times.html#cb336-2" aria-hidden="true" tabindex="-1"></a>exT1</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 1
#R&gt;     TSTR    
#R&gt;     &lt;chr&gt;   
#R&gt;   1 12:15:01
#R&gt;   2 9:14:56 
#R&gt;   3 19:34:01</code></pre>
<p>Here, I prepend a “dummy date” of “1-Jan-2021” to each time.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb338-1"><a href="dates-and-times.html#cb338-1" aria-hidden="true" tabindex="-1"></a>exT1 <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">DTSTR=</span><span class="fu">paste</span>(<span class="st">&quot;1-Jan-2021&quot;</span>,TSTR))</span>
<span id="cb338-2"><a href="dates-and-times.html#cb338-2" aria-hidden="true" tabindex="-1"></a>exT1</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 2
#R&gt;     TSTR     DTSTR              
#R&gt;     &lt;chr&gt;    &lt;chr&gt;              
#R&gt;   1 12:15:01 1-Jan-2021 12:15:01
#R&gt;   2 9:14:56  1-Jan-2021 9:14:56 
#R&gt;   3 19:34:01 1-Jan-2021 19:34:01</code></pre>
<p>This date and time string can then be handled as shown in the Section <a href="dates-and-times.html#calculations-with-date-times">9.6</a>.</p>
</div>
<div id="dates-and-times-1" class="section level3" number="9.4.2">
<h3><span class="header-section-number">9.4.2</span> Dates and Times</h3>
<p>Date and time strings should be in a general format that has the date first followed by the time with the two separated by a space. The date portion can be in any format as described in Section <a href="dates-and-times.html#obtaining-dates-data">9.1</a> for dates and the time should generally be in hour-minute or hour-minute-second format. The time components can be separated by nearly any character but it will usually be a “:” The <code>DTSTR</code> variable in the data frame created in the previous section is in this format, as is the same variable in the data frame below.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb340-1"><a href="dates-and-times.html#cb340-1" aria-hidden="true" tabindex="-1"></a>exT2 <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">DTSTR=</span><span class="fu">c</span>(<span class="st">&quot;2021-7-15 12:15:01&quot;</span>,<span class="st">&quot;2020-9-21 9:14:56&quot;</span>,<span class="st">&quot;2019-3-3 19:34:01&quot;</span>))</span>
<span id="cb340-2"><a href="dates-and-times.html#cb340-2" aria-hidden="true" tabindex="-1"></a>exT2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 1
#R&gt;     DTSTR             
#R&gt;     &lt;chr&gt;             
#R&gt;   1 2021-7-15 12:15:01
#R&gt;   2 2020-9-21 9:14:56 
#R&gt;   3 2019-3-3 19:34:01</code></pre>
<p>a character variable with date and times in these formats are converted to a date-time class variable with the <code>lubridate</code> functions described in Section <a href="dates-and-times.html#obtaining-dates-data">9.1</a> but with <code>_hm</code> or <code>_hms</code> appended depending on whether the time portion is hour-minute or hour-minute-second data. For example, if the dates are in year-month-day format and the times are in hours-minutes-seconds then use <code>ymd_hms()</code>.</p>
<p>Another concern with converting to a date-time class is concerns about the time zone. This most likely becomes an issue if you are finding intervals of time from a base time (say, New Years at 12 am) or among times from different time zones (e.g., airline flight data). The time zone for a date-time variable can be set with <code>tz=</code>. The time-zone is set with so-called “Olson Names.” You can see all names recognized in R with <code>OlsonNames()</code>. Most Olson Names begin with a continentent separated by a place on that continent by a forward slash. For example, <code>America/Chicago</code> would use the time zone for Chicago in America (i.e., “Central” time). Time zones in the United States can also generally be set with <code>US/Eastern</code>, <code>US/Central</code>, <code>US/Mountain</code>, and <code>US/Pacific</code>. Note, however, that time zones are “odd” for some areas so there are special codes for those places. One of regional note is <code>US/Michigan</code>.</p>
<p>The code below converts the <code>DTSTR</code> string in <code>exT2</code> to a date-time class using the <code>US/Central</code> time zone and removes the original string (for aesthetics only). Note how the new variable is a “datetime” class.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb342-1"><a href="dates-and-times.html#cb342-1" aria-hidden="true" tabindex="-1"></a>exT2 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb342-2"><a href="dates-and-times.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATETIME=</span><span class="fu">ymd_hms</span>(DTSTR,<span class="at">tz=</span><span class="st">&quot;US/Central&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb342-3"><a href="dates-and-times.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>DTSTR)</span>
<span id="cb342-4"><a href="dates-and-times.html#cb342-4" aria-hidden="true" tabindex="-1"></a>exT2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 1
#R&gt;     DATETIME           
#R&gt;     &lt;dttm&gt;             
#R&gt;   1 2021-07-15 12:15:01
#R&gt;   2 2020-09-21 09:14:56
#R&gt;   3 2019-03-03 19:34:01</code></pre>
</div>
</div>
<div id="extracting-time-components" class="section level2" number="9.5">
<h2><span class="header-section-number">9.5</span> Extracting Time Components</h2>
<p>Hours, minutes, and seconds from a date-time object can be extracted with <code>hour()</code>, <code>minute()</code>, and <code>second()</code>.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb344-1"><a href="dates-and-times.html#cb344-1" aria-hidden="true" tabindex="-1"></a>exT2 <span class="sc">%&gt;%</span></span>
<span id="cb344-2"><a href="dates-and-times.html#cb344-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">hr=</span><span class="fu">hour</span>(DATETIME),</span>
<span id="cb344-3"><a href="dates-and-times.html#cb344-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">min=</span><span class="fu">minute</span>(DATETIME),</span>
<span id="cb344-4"><a href="dates-and-times.html#cb344-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">sec=</span><span class="fu">second</span>(DATETIME))</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 4
#R&gt;     DATETIME               hr   min   sec
#R&gt;     &lt;dttm&gt;              &lt;int&gt; &lt;int&gt; &lt;dbl&gt;
#R&gt;   1 2021-07-15 12:15:01    12    15     1
#R&gt;   2 2020-09-21 09:14:56     9    14    56
#R&gt;   3 2019-03-03 19:34:01    19    34     1</code></pre>
</div>
<div id="calculations-with-date-times" class="section level2" number="9.6">
<h2><span class="header-section-number">9.6</span> Calculations with Date-Times</h2>
<p>As shown with dates in Section <a href="dates-and-times.html#calculations-with-dates">9.3</a>, intervals of time can be found between two times. In the example below <code>int2now</code> contains the interval of time between the date-time in <code>DATETIME</code> and the current date-time as returned by <code>now()</code>.<a href="#fn31" class="footnote-ref" id="fnref31"><sup>31</sup></a> The number of hours and days are then found using <code>time_length()</code> in the same was as shown for dates in Section <a href="dates-and-times.html#calculations-with-dates">9.3</a>. I moved the <code>int2now</code> variable to the end simply so that the other two variables would show in the tibble.</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb346-1"><a href="dates-and-times.html#cb346-1" aria-hidden="true" tabindex="-1"></a>exT2 <span class="sc">%&lt;&gt;%</span></span>
<span id="cb346-2"><a href="dates-and-times.html#cb346-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">int2now=</span>DATETIME <span class="sc">%--%</span> <span class="fu">now</span>(),</span>
<span id="cb346-3"><a href="dates-and-times.html#cb346-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">hrs2now=</span><span class="fu">time_length</span>(int2now,<span class="at">unit=</span><span class="st">&quot;hours&quot;</span>),</span>
<span id="cb346-4"><a href="dates-and-times.html#cb346-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">days2now=</span><span class="fu">time_length</span>(int2now,<span class="at">unit=</span><span class="st">&quot;days&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb346-5"><a href="dates-and-times.html#cb346-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(int2now,<span class="at">.after=</span><span class="fu">last_col</span>())</span>
<span id="cb346-6"><a href="dates-and-times.html#cb346-6" aria-hidden="true" tabindex="-1"></a>exT2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 4
#R&gt;     DATETIME            hrs2now days2now
#R&gt;     &lt;dttm&gt;                &lt;dbl&gt;    &lt;dbl&gt;
#R&gt;   1 2021-07-15 12:15:01    500.     20.8
#R&gt;   2 2020-09-21 09:14:56   7631.    318. 
#R&gt;   3 2019-03-03 19:34:01  21252.    885. 
#R&gt;   # ... with 1 more variable: int2now &lt;Interval&gt;</code></pre>
<p> </p>
<p>A quick return to the data frame from Section <a href="dates-and-times.html#just-times">9.4.1</a>. Suppose that the researcher wants to find the number of minutes between the given time (which was converted to a date-time) and dinner at 6 pm. Note that if you use the trick of adding a dummy date then you must use the same dummy date here.</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb348-1"><a href="dates-and-times.html#cb348-1" aria-hidden="true" tabindex="-1"></a>exT1a <span class="ot">&lt;-</span> exT1 <span class="sc">%&gt;%</span></span>
<span id="cb348-2"><a href="dates-and-times.html#cb348-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">DATETIME=</span><span class="fu">dmy_hms</span>(DTSTR,<span class="at">tz=</span><span class="st">&quot;US/Central&quot;</span>),</span>
<span id="cb348-3"><a href="dates-and-times.html#cb348-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">int2dinner=</span>DATETIME <span class="sc">%--%</span> <span class="fu">dmy_hms</span>(<span class="st">&quot;1-Jan-2021 18:00:00&quot;</span>,<span class="at">tz=</span><span class="st">&quot;US/Central&quot;</span>),</span>
<span id="cb348-4"><a href="dates-and-times.html#cb348-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">mins2dinner=</span><span class="fu">time_length</span>(int2dinner,<span class="at">unit=</span><span class="st">&quot;minutes&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb348-5"><a href="dates-and-times.html#cb348-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>TSTR,<span class="sc">-</span>DTSTR) <span class="sc">%&gt;%</span></span>
<span id="cb348-6"><a href="dates-and-times.html#cb348-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(mins2dinner,<span class="at">.after=</span>DATETIME)</span>
<span id="cb348-7"><a href="dates-and-times.html#cb348-7" aria-hidden="true" tabindex="-1"></a>exT1a</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 3 x 3
#R&gt;     DATETIME            mins2dinner
#R&gt;     &lt;dttm&gt;                    &lt;dbl&gt;
#R&gt;   1 2021-01-01 12:15:01       345. 
#R&gt;   2 2021-01-01 09:14:56       525. 
#R&gt;   3 2021-01-01 19:34:01       -94.0
#R&gt;   # ... with 1 more variable: int2dinner &lt;Interval&gt;</code></pre>
</div>
<div id="examples-in-context-1" class="section level2" number="9.7">
<h2><span class="header-section-number">9.7</span> Examples in Context</h2>
<div id="sales-transactions" class="section level3" number="9.7.1">
<h3><span class="header-section-number">9.7.1</span> Sales Transactions</h3>
<p>This example examines results for a trading company as presented in <a href="https://blog.rsquaredacademy.com/handling-date-and-time-in-r/">an RSquared Academy blogpost</a>. The data in <a href="https://raw.githubusercontent.com/droglenc/BookWrangling/main/data/transact.csv">transact.csv</a><a href="#fn32" class="footnote-ref" id="fnref32"><sup>32</sup></a> represent the dates that an invoice was sent, payment of the invoice was due, and payment was received. As you can see from the data frame below, <code>read_csv()</code> accurately determined that each column contained dates and thus automatically read those columns in as of the date class.</p>
<div class="sourceCode" id="cb350"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb350-1"><a href="dates-and-times.html#cb350-1" aria-hidden="true" tabindex="-1"></a>trans <span class="ot">&lt;-</span> <span class="fu">read_csv</span>(<span class="fu">file.path</span>(<span class="st">&quot;data&quot;</span>,<span class="st">&quot;transact.csv&quot;</span>))</span>
<span id="cb350-2"><a href="dates-and-times.html#cb350-2" aria-hidden="true" tabindex="-1"></a>trans</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2,466 x 3
#R&gt;      Invoice    Due        Payment   
#R&gt;      &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    
#R&gt;    1 2013-01-02 2013-02-01 2013-01-15
#R&gt;    2 2013-01-26 2013-02-25 2013-03-03
#R&gt;    3 2013-07-03 2013-08-02 2013-07-08
#R&gt;    4 2013-02-10 2013-03-12 2013-03-17
#R&gt;    5 2012-10-25 2012-11-24 2012-11-28
#R&gt;    6 2012-01-27 2012-02-26 2012-02-22
#R&gt;    7 2013-08-13 2013-09-12 2013-09-09
#R&gt;    8 2012-12-16 2013-01-15 2013-01-12
#R&gt;    9 2012-05-14 2012-06-13 2012-07-01
#R&gt;   10 2013-07-01 2013-07-31 2013-07-26
#R&gt;   # ... with 2,456 more rows</code></pre>
<p>Part of the analysis will require summarizing results by years, quarters, and months. Thus, these variables were added to the data frame below.</p>
<div class="sourceCode" id="cb352"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb352-1"><a href="dates-and-times.html#cb352-1" aria-hidden="true" tabindex="-1"></a>trans <span class="sc">%&lt;&gt;%</span></span>
<span id="cb352-2"><a href="dates-and-times.html#cb352-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">yr=</span><span class="fu">year</span>(Due),</span>
<span id="cb352-3"><a href="dates-and-times.html#cb352-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">mon=</span><span class="fu">month</span>(Due,<span class="at">label=</span><span class="cn">TRUE</span>),</span>
<span id="cb352-4"><a href="dates-and-times.html#cb352-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">qrtr=</span><span class="fu">quarter</span>(Due)) <span class="sc">%&gt;%</span></span>
<span id="cb352-5"><a href="dates-and-times.html#cb352-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(yr<span class="sc">:</span>qrtr)</span>
<span id="cb352-6"><a href="dates-and-times.html#cb352-6" aria-hidden="true" tabindex="-1"></a>trans</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2,466 x 6
#R&gt;         yr mon    qrtr Invoice    Due        Payment   
#R&gt;      &lt;dbl&gt; &lt;ord&gt; &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;    
#R&gt;    1  2013 Feb       1 2013-01-02 2013-02-01 2013-01-15
#R&gt;    2  2013 Feb       1 2013-01-26 2013-02-25 2013-03-03
#R&gt;    3  2013 Aug       3 2013-07-03 2013-08-02 2013-07-08
#R&gt;    4  2013 Mar       1 2013-02-10 2013-03-12 2013-03-17
#R&gt;    5  2012 Nov       4 2012-10-25 2012-11-24 2012-11-28
#R&gt;    6  2012 Feb       1 2012-01-27 2012-02-26 2012-02-22
#R&gt;    7  2013 Sep       3 2013-08-13 2013-09-12 2013-09-09
#R&gt;    8  2013 Jan       1 2012-12-16 2013-01-15 2013-01-12
#R&gt;    9  2012 Jun       2 2012-05-14 2012-06-13 2012-07-01
#R&gt;   10  2013 Jul       3 2013-07-01 2013-07-31 2013-07-26
#R&gt;   # ... with 2,456 more rows</code></pre>
<p>Two questions that the team wanted to ask from these data were (1) what is the average days it took to make payment (from when the invoice was issued and (2) the average days past due for payments that were not paid on time. Answering the first question requires making an interval of the invoice to payment time and then determining how long that interval was.</p>
<div class="sourceCode" id="cb354"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb354-1"><a href="dates-and-times.html#cb354-1" aria-hidden="true" tabindex="-1"></a>trans <span class="sc">%&lt;&gt;%</span></span>
<span id="cb354-2"><a href="dates-and-times.html#cb354-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">settle_days=</span><span class="fu">time_length</span>(Invoice <span class="sc">%--%</span> Payment,<span class="at">unit=</span><span class="st">&quot;days&quot;</span>))</span>
<span id="cb354-3"><a href="dates-and-times.html#cb354-3" aria-hidden="true" tabindex="-1"></a>trans</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2,466 x 7
#R&gt;         yr mon    qrtr Invoice    Due        Payment    settle_days
#R&gt;      &lt;dbl&gt; &lt;ord&gt; &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;           &lt;dbl&gt;
#R&gt;    1  2013 Feb       1 2013-01-02 2013-02-01 2013-01-15          13
#R&gt;    2  2013 Feb       1 2013-01-26 2013-02-25 2013-03-03          36
#R&gt;    3  2013 Aug       3 2013-07-03 2013-08-02 2013-07-08           5
#R&gt;    4  2013 Mar       1 2013-02-10 2013-03-12 2013-03-17          35
#R&gt;    5  2012 Nov       4 2012-10-25 2012-11-24 2012-11-28          34
#R&gt;    6  2012 Feb       1 2012-01-27 2012-02-26 2012-02-22          26
#R&gt;    7  2013 Sep       3 2013-08-13 2013-09-12 2013-09-09          27
#R&gt;    8  2013 Jan       1 2012-12-16 2013-01-15 2013-01-12          27
#R&gt;    9  2012 Jun       2 2012-05-14 2012-06-13 2012-07-01          48
#R&gt;   10  2013 Jul       3 2013-07-01 2013-07-31 2013-07-26          25
#R&gt;   # ... with 2,456 more rows</code></pre>
<p>The results are summarized by quarter within each year below.</p>
<div class="sourceCode" id="cb356"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb356-1"><a href="dates-and-times.html#cb356-1" aria-hidden="true" tabindex="-1"></a>trans <span class="sc">%&gt;%</span></span>
<span id="cb356-2"><a href="dates-and-times.html#cb356-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(yr,qrtr) <span class="sc">%&gt;%</span></span>
<span id="cb356-3"><a href="dates-and-times.html#cb356-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">mean=</span><span class="fu">mean</span>(settle_days),</span>
<span id="cb356-4"><a href="dates-and-times.html#cb356-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd=</span><span class="fu">sd</span>(settle_days),</span>
<span id="cb356-5"><a href="dates-and-times.html#cb356-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">min=</span><span class="fu">min</span>(settle_days),</span>
<span id="cb356-6"><a href="dates-and-times.html#cb356-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">max=</span><span class="fu">max</span>(settle_days))</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 9 x 6
#R&gt;   # Groups:   yr [3]
#R&gt;        yr  qrtr  mean    sd   min   max
#R&gt;     &lt;dbl&gt; &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1  2012     1  29.6  12.4     3    64
#R&gt;   2  2012     2  28.6  12.2     1    63
#R&gt;   3  2012     3  27.7  12.5     1    67
#R&gt;   4  2012     4  27.3  11.4     2    75
#R&gt;   5  2013     1  25.8  12.1     1    64
#R&gt;   6  2013     2  26.3  13.2     0    64
#R&gt;   7  2013     3  24.8  12.0     0    59
#R&gt;   8  2013     4  22.7  11.8     1    57
#R&gt;   9  2014     1  23    10.3    11    36</code></pre>
<p>Answering the second question requires finding the length of interval between the due and payment dates and then replacing all of the negative numbers with <code>NA</code> because they do not represent an overdue payment.</p>
<div class="sourceCode" id="cb358"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb358-1"><a href="dates-and-times.html#cb358-1" aria-hidden="true" tabindex="-1"></a>trans <span class="sc">%&lt;&gt;%</span></span>
<span id="cb358-2"><a href="dates-and-times.html#cb358-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">overdue_days=</span><span class="fu">time_length</span>(Due <span class="sc">%--%</span> Payment,<span class="at">unit=</span><span class="st">&quot;days&quot;</span>),</span>
<span id="cb358-3"><a href="dates-and-times.html#cb358-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">overdue_days=</span><span class="fu">ifelse</span>(overdue_days<span class="sc">&gt;</span><span class="dv">0</span>,overdue_days,<span class="cn">NA_real_</span>))</span>
<span id="cb358-4"><a href="dates-and-times.html#cb358-4" aria-hidden="true" tabindex="-1"></a>trans</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 2,466 x 8
#R&gt;         yr mon    qrtr Invoice    Due        Payment    settle_days overdue_days
#R&gt;      &lt;dbl&gt; &lt;ord&gt; &lt;int&gt; &lt;date&gt;     &lt;date&gt;     &lt;date&gt;           &lt;dbl&gt;        &lt;dbl&gt;
#R&gt;    1  2013 Feb       1 2013-01-02 2013-02-01 2013-01-15          13           NA
#R&gt;    2  2013 Feb       1 2013-01-26 2013-02-25 2013-03-03          36            6
#R&gt;    3  2013 Aug       3 2013-07-03 2013-08-02 2013-07-08           5           NA
#R&gt;    4  2013 Mar       1 2013-02-10 2013-03-12 2013-03-17          35            5
#R&gt;    5  2012 Nov       4 2012-10-25 2012-11-24 2012-11-28          34            4
#R&gt;    6  2012 Feb       1 2012-01-27 2012-02-26 2012-02-22          26           NA
#R&gt;    7  2013 Sep       3 2013-08-13 2013-09-12 2013-09-09          27           NA
#R&gt;    8  2013 Jan       1 2012-12-16 2013-01-15 2013-01-12          27           NA
#R&gt;    9  2012 Jun       2 2012-05-14 2012-06-13 2012-07-01          48           18
#R&gt;   10  2013 Jul       3 2013-07-01 2013-07-31 2013-07-26          25           NA
#R&gt;   # ... with 2,456 more rows</code></pre>
<p>The results are summarized by quarter within each year below.</p>
<div class="sourceCode" id="cb360"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb360-1"><a href="dates-and-times.html#cb360-1" aria-hidden="true" tabindex="-1"></a>trans <span class="sc">%&gt;%</span></span>
<span id="cb360-2"><a href="dates-and-times.html#cb360-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(yr,qrtr) <span class="sc">%&gt;%</span></span>
<span id="cb360-3"><a href="dates-and-times.html#cb360-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">total_n=</span><span class="fu">n</span>(),</span>
<span id="cb360-4"><a href="dates-and-times.html#cb360-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">overdue_n=</span><span class="fu">sum</span>(<span class="sc">!</span><span class="fu">is.na</span>(overdue_days)),</span>
<span id="cb360-5"><a href="dates-and-times.html#cb360-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean=</span><span class="fu">mean</span>(overdue_days,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb360-6"><a href="dates-and-times.html#cb360-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd=</span><span class="fu">sd</span>(overdue_days,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb360-7"><a href="dates-and-times.html#cb360-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">min=</span><span class="fu">min</span>(overdue_days,<span class="at">na.rm=</span><span class="cn">TRUE</span>),</span>
<span id="cb360-8"><a href="dates-and-times.html#cb360-8" aria-hidden="true" tabindex="-1"></a>            <span class="at">max=</span><span class="fu">max</span>(overdue_days,<span class="at">na.rm=</span><span class="cn">TRUE</span>))</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 9 x 8
#R&gt;   # Groups:   yr [3]
#R&gt;        yr  qrtr total_n overdue_n  mean    sd   min   max
#R&gt;     &lt;dbl&gt; &lt;int&gt;   &lt;int&gt;     &lt;int&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1  2012     1     189        84 10.9   7.14     1    34
#R&gt;   2  2012     2     324       129 10.6   7.43     1    33
#R&gt;   3  2012     3     309       121 10.0   7.29     1    37
#R&gt;   4  2012     4     345       124  9.20  7.37     1    45
#R&gt;   5  2013     1     327       115  9.15  6.70     1    34
#R&gt;   6  2013     2     337       121 10.3   8.05     1    34
#R&gt;   7  2013     3     309        97  8.98  6.33     1    29
#R&gt;   8  2013     4     321        85  7.89  5.79     1    27
#R&gt;   9  2014     1       5         1  6    NA        6     6</code></pre>
<p> </p>
</div>
<div id="stream-discharge" class="section level3" number="9.7.2">
<h3><span class="header-section-number">9.7.2</span> Stream Discharge</h3>
<p>The U.S. Geological Survey (USGS) monitors stream/river discharge at a large number of stations around the United States. These data can be accessed via the <a href="https://waterdata.usgs.gov/nwis">National Water Information System: Web Interface</a>. Here I will examine provisional data available for 2021 (up to 3-Aug, the day I accessed the data). The following steps were taken on the NWIS site to produce a <strong>tab</strong>-delimited file for use below.</p>
<ul>
<li>Selected “Current Conditions” button.</li>
<li>Selected Wisconsin on the US map.</li>
<li>Carefully selected the “Whittlesey Creek” dot on the Wisconsin map.</li>
<li>Selected only “00060 Discharge” from “Available Parameters,” “Tab-separated” from “Output format,” and enter “2021-01-01” into “Begin Date.” Pressed “GO” button.</li>
<li>Copied URL from the ensuing page into <code>read_tsv()</code> below. [<em>Note that the top of the file has many lines of comments each preceded by a ‘#,’ which precipates the use of <code>comment=</code> below.</em>]</li>
</ul>
<div class="sourceCode" id="cb362"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb362-1"><a href="dates-and-times.html#cb362-1" aria-hidden="true" tabindex="-1"></a>wcd <span class="ot">&lt;-</span> <span class="fu">read_tsv</span>(<span class="st">&quot;https://nwis.waterdata.usgs.gov/usa/nwis/uv/?cb_00045=on&amp;cb_00060=on&amp;format=rdb&amp;site_no=040263205&amp;period=&amp;begin_date=2021-01-01&amp;end_date=2021-08-03&quot;</span>,</span>
<span id="cb362-2"><a href="dates-and-times.html#cb362-2" aria-hidden="true" tabindex="-1"></a>                <span class="at">comment=</span><span class="st">&quot;#&quot;</span>)</span>
<span id="cb362-3"><a href="dates-and-times.html#cb362-3" aria-hidden="true" tabindex="-1"></a>wcd</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 61,896 x 8
#R&gt;      agency_cd site_no   datetime         tz_cd `157029_00060` `157029_00060_cd`
#R&gt;      &lt;chr&gt;     &lt;chr&gt;     &lt;chr&gt;            &lt;chr&gt; &lt;chr&gt;          &lt;chr&gt;            
#R&gt;    1 5s        15s       20d              6s    14n            10s              
#R&gt;    2 USGS      040263205 2021-01-01 00:00 CST   17.7           P                
#R&gt;    3 USGS      040263205 2021-01-01 00:05 CST   17.7           P                
#R&gt;    4 USGS      040263205 2021-01-01 00:10 CST   17.7           P                
#R&gt;    5 USGS      040263205 2021-01-01 00:15 CST   17.7           P                
#R&gt;    6 USGS      040263205 2021-01-01 00:20 CST   17.8           P                
#R&gt;    7 USGS      040263205 2021-01-01 00:25 CST   17.8           P                
#R&gt;    8 USGS      040263205 2021-01-01 00:30 CST   17.8           P                
#R&gt;    9 USGS      040263205 2021-01-01 00:35 CST   17.7           P                
#R&gt;   10 USGS      040263205 2021-01-01 00:40 CST   17.7           P                
#R&gt;   # ... with 61,886 more rows, and 2 more variables: 157030_00045 &lt;chr&gt;,
#R&gt;   #   157030_00045_cd &lt;chr&gt;</code></pre>
<p>There are several issues with the way these data load into R.</p>
<ol style="list-style-type: decimal">
<li>The first line of the data frame is not data at all; this row is removed with <code>slice()</code> below.</li>
<li>All columns with “cd” in the name can be removed … they either note that the data is provisional or are all constants. Do note that the time zone is “CST.”</li>
<li>Thes <code>site_no</code> column can be removed (it is a constant).</li>
<li>The discharge data is in the column that ends with “00060” and the precipitation data is in the column that ends with “00045.” These names should be changed to be more useful.</li>
<li>The <code>datetime</code> variable needs to be converted from a character to datetime class.</li>
<li>The <code>discharge</code> and <code>precip</code> variables need to be converted from a character to a numeric class (with <code>as.numeric()</code> below).</li>
</ol>
<div class="sourceCode" id="cb364"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb364-1"><a href="dates-and-times.html#cb364-1" aria-hidden="true" tabindex="-1"></a>wcd <span class="sc">%&lt;&gt;%</span></span>
<span id="cb364-2"><a href="dates-and-times.html#cb364-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">slice</span>(<span class="sc">-</span><span class="dv">1</span>) <span class="sc">%&gt;%</span></span>
<span id="cb364-3"><a href="dates-and-times.html#cb364-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">ends_with</span>(<span class="st">&quot;cd&quot;</span>),<span class="sc">-</span>site_no) <span class="sc">%&gt;%</span></span>
<span id="cb364-4"><a href="dates-and-times.html#cb364-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">discharge=</span><span class="fu">ends_with</span>(<span class="st">&quot;00060&quot;</span>),</span>
<span id="cb364-5"><a href="dates-and-times.html#cb364-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">precip=</span><span class="fu">ends_with</span>(<span class="st">&quot;00045&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb364-6"><a href="dates-and-times.html#cb364-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">datetime=</span><span class="fu">ymd_hm</span>(datetime),</span>
<span id="cb364-7"><a href="dates-and-times.html#cb364-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">discharge=</span><span class="fu">as.numeric</span>(discharge),</span>
<span id="cb364-8"><a href="dates-and-times.html#cb364-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">precip=</span><span class="fu">as.numeric</span>(precip))</span>
<span id="cb364-9"><a href="dates-and-times.html#cb364-9" aria-hidden="true" tabindex="-1"></a>wcd</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 61,895 x 3
#R&gt;      datetime            discharge precip
#R&gt;      &lt;dttm&gt;                  &lt;dbl&gt;  &lt;dbl&gt;
#R&gt;    1 2021-01-01 00:00:00      17.7     NA
#R&gt;    2 2021-01-01 00:05:00      17.7     NA
#R&gt;    3 2021-01-01 00:10:00      17.7     NA
#R&gt;    4 2021-01-01 00:15:00      17.7     NA
#R&gt;    5 2021-01-01 00:20:00      17.8     NA
#R&gt;    6 2021-01-01 00:25:00      17.8     NA
#R&gt;    7 2021-01-01 00:30:00      17.8     NA
#R&gt;    8 2021-01-01 00:35:00      17.7     NA
#R&gt;    9 2021-01-01 00:40:00      17.7     NA
#R&gt;   10 2021-01-01 00:45:00      17.8     NA
#R&gt;   # ... with 61,885 more rows</code></pre>
<p>The discharge data can then be plotted as follows (note the log scale).</p>
<p><img src="BookWrangling_files/figure-html/unnamed-chunk-191-1.png" width="432" style="display: block; margin: auto;" /></p>
<p> </p>
<p>Suppose that the researchers want to examine discharge for various periods of time (say weekly and monthly). The data frame then needs to include variables that identify weeks and months.</p>
<div class="sourceCode" id="cb366"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb366-1"><a href="dates-and-times.html#cb366-1" aria-hidden="true" tabindex="-1"></a>wcd <span class="sc">%&lt;&gt;%</span></span>
<span id="cb366-2"><a href="dates-and-times.html#cb366-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">wk=</span><span class="fu">week</span>(datetime),</span>
<span id="cb366-3"><a href="dates-and-times.html#cb366-3" aria-hidden="true" tabindex="-1"></a>         <span class="at">mon=</span><span class="fu">month</span>(datetime,<span class="at">label=</span><span class="cn">TRUE</span>))</span>
<span id="cb366-4"><a href="dates-and-times.html#cb366-4" aria-hidden="true" tabindex="-1"></a>wcd</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 61,895 x 5
#R&gt;      datetime            discharge precip    wk mon  
#R&gt;      &lt;dttm&gt;                  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt;
#R&gt;    1 2021-01-01 00:00:00      17.7     NA     1 Jan  
#R&gt;    2 2021-01-01 00:05:00      17.7     NA     1 Jan  
#R&gt;    3 2021-01-01 00:10:00      17.7     NA     1 Jan  
#R&gt;    4 2021-01-01 00:15:00      17.7     NA     1 Jan  
#R&gt;    5 2021-01-01 00:20:00      17.8     NA     1 Jan  
#R&gt;    6 2021-01-01 00:25:00      17.8     NA     1 Jan  
#R&gt;    7 2021-01-01 00:30:00      17.8     NA     1 Jan  
#R&gt;    8 2021-01-01 00:35:00      17.7     NA     1 Jan  
#R&gt;    9 2021-01-01 00:40:00      17.7     NA     1 Jan  
#R&gt;   10 2021-01-01 00:45:00      17.8     NA     1 Jan  
#R&gt;   # ... with 61,885 more rows</code></pre>
<p>For example, statistical summaries can then be computed by, for example, month.</p>
<div class="sourceCode" id="cb368"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb368-1"><a href="dates-and-times.html#cb368-1" aria-hidden="true" tabindex="-1"></a>wcd_sum_mon <span class="ot">&lt;-</span> wcd <span class="sc">%&gt;%</span></span>
<span id="cb368-2"><a href="dates-and-times.html#cb368-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(mon) <span class="sc">%&gt;%</span></span>
<span id="cb368-3"><a href="dates-and-times.html#cb368-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">n=</span><span class="fu">n</span>(),</span>
<span id="cb368-4"><a href="dates-and-times.html#cb368-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">mean=</span><span class="fu">mean</span>(discharge),</span>
<span id="cb368-5"><a href="dates-and-times.html#cb368-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">sd=</span><span class="fu">sd</span>(discharge),</span>
<span id="cb368-6"><a href="dates-and-times.html#cb368-6" aria-hidden="true" tabindex="-1"></a>            <span class="at">min=</span><span class="fu">min</span>(discharge),</span>
<span id="cb368-7"><a href="dates-and-times.html#cb368-7" aria-hidden="true" tabindex="-1"></a>            <span class="at">max=</span><span class="fu">max</span>(discharge))</span>
<span id="cb368-8"><a href="dates-and-times.html#cb368-8" aria-hidden="true" tabindex="-1"></a>wcd_sum_mon</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 8 x 6
#R&gt;     mon       n  mean     sd   min   max
#R&gt;     &lt;ord&gt; &lt;int&gt; &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;   1 Jan    8928  17.6  0.272  16.9  18.9
#R&gt;   2 Feb    8064  17.0  0.223  16.3  17.7
#R&gt;   3 Mar    8916  33.4 31.8    16.5 257  
#R&gt;   4 Apr    8640  28.3 19.1    18.3 196  
#R&gt;   5 May    8915  20.3  5.16   17.4  85.5
#R&gt;   6 Jun    8640  NA   NA      NA    NA  
#R&gt;   7 Jul    8928  17.7  0.745  16.6  27.7
#R&gt;   8 Aug     864  17.9  0.257  17.2  18.4</code></pre>
<p>From this it is clear that discharge was relatively constant (low SD values) with an average between 17 and 18 cfs in January, February, June, July, and August, but more variable and with greater mean discharge in March, April, and, to a lesser degree, May.</p>
<p>For fun, it is often interesting to look at the discharge plot around a “flashy” event. The code below finds the “datetime” for the maximum discharge.</p>
<div class="sourceCode" id="cb370"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb370-1"><a href="dates-and-times.html#cb370-1" aria-hidden="true" tabindex="-1"></a>wcd<span class="sc">$</span>datetime[<span class="fu">which.max</span>(wcd<span class="sc">$</span>discharge)]</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   [1] &quot;2021-03-10 23:00:00 UTC&quot;</code></pre>
<p>A new data frame that is around this point of maximum discharge is then created with <code>filter()</code>.</p>
<div class="sourceCode" id="cb372"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb372-1"><a href="dates-and-times.html#cb372-1" aria-hidden="true" tabindex="-1"></a>wcd1 <span class="ot">&lt;-</span> wcd <span class="sc">%&gt;%</span></span>
<span id="cb372-2"><a href="dates-and-times.html#cb372-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(datetime<span class="sc">&gt;=</span><span class="fu">ymd_hms</span>(<span class="st">&quot;2021-03-09 12:00:00&quot;</span>),</span>
<span id="cb372-3"><a href="dates-and-times.html#cb372-3" aria-hidden="true" tabindex="-1"></a>         datetime<span class="sc">&lt;=</span><span class="fu">ymd_hms</span>(<span class="st">&quot;2021-03-12 6:00:00&quot;</span>))</span>
<span id="cb372-4"><a href="dates-and-times.html#cb372-4" aria-hidden="true" tabindex="-1"></a>wcd1</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;   # A tibble: 793 x 5
#R&gt;      datetime            discharge precip    wk mon  
#R&gt;      &lt;dttm&gt;                  &lt;dbl&gt;  &lt;dbl&gt; &lt;dbl&gt; &lt;ord&gt;
#R&gt;    1 2021-03-09 12:00:00      19       NA    10 Mar  
#R&gt;    2 2021-03-09 12:05:00      19       NA    10 Mar  
#R&gt;    3 2021-03-09 12:10:00      19       NA    10 Mar  
#R&gt;    4 2021-03-09 12:15:00      19       NA    10 Mar  
#R&gt;    5 2021-03-09 12:20:00      19       NA    10 Mar  
#R&gt;    6 2021-03-09 12:25:00      19       NA    10 Mar  
#R&gt;    7 2021-03-09 12:30:00      19.1     NA    10 Mar  
#R&gt;    8 2021-03-09 12:35:00      19.1     NA    10 Mar  
#R&gt;    9 2021-03-09 12:40:00      19.1     NA    10 Mar  
#R&gt;   10 2021-03-09 12:45:00      19.2     NA    10 Mar  
#R&gt;   # ... with 783 more rows</code></pre>
<p>Which can then be plotted.</p>
<p><img src="BookWrangling_files/figure-html/unnamed-chunk-196-1.png" width="432" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="26">
<li id="fn26"><p>Everything done in this module can also be accomplished with functions in base R. However, the functions of <code>lubridate</code> and their arguments are generally more consistent.<a href="dates-and-times.html#fnref26" class="footnote-back">↩︎</a></p></li>
<li id="fn27"><p>For example, <code>yday()</code> returns a 1 for January 1st.<a href="dates-and-times.html#fnref27" class="footnote-back">↩︎</a></p></li>
<li id="fn28"><p>By default the week day starts on “Sunday.”<a href="dates-and-times.html#fnref28" class="footnote-back">↩︎</a></p></li>
<li id="fn29"><p>A week is defined here as a full seven day period and is inclusive of the current seven day period. Thus, the week for 1-Jan will always be 1 and 8-Jan will always be 2.<a href="dates-and-times.html#fnref29" class="footnote-back">↩︎</a></p></li>
<li id="fn30"><p>As long as <code>time_length()</code> is given an interval class type.<a href="dates-and-times.html#fnref30" class="footnote-back">↩︎</a></p></li>
<li id="fn31"><p>Note the use of <code>now()</code> with date-times, whereas as <code>today()</code> is used just for dates.<a href="dates-and-times.html#fnref31" class="footnote-back">↩︎</a></p></li>
<li id="fn32"><p>Original data from <a href="https://raw.githubusercontent.com/rsquaredacademy/datasets/master/transact.csv">rsquaredacadamy</a>.<a href="dates-and-times.html#fnref32" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="groupings.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="strings.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

</body>

</html>
