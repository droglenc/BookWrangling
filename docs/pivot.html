<!DOCTYPE html>
<html lang="en" xml:lang="en">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Module 5 Pivot | Readings for MTH250 - Data Wrangling</title>
  <meta name="description" content="This book contains the readings for MTH250W at Northland College." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="Module 5 Pivot | Readings for MTH250 - Data Wrangling" />
  <meta property="og:type" content="book" />
  <meta property="og:url" content="http://derekogle.com/BookWrangling/" />
  
  <meta property="og:description" content="This book contains the readings for MTH250W at Northland College." />
  <meta name="github-repo" content="droglenc/BookWrangling" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Module 5 Pivot | Readings for MTH250 - Data Wrangling" />
  
  <meta name="twitter:description" content="This book contains the readings for MTH250W at Northland College." />
  

<meta name="author" content="Derek H. Ogle" />


<meta name="date" content="2021-08-17" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="relational-data.html"/>
<link rel="next" href="wrangle-columns.html"/>
<script src="libs/header-attrs-2.10/header-attrs.js"></script>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>
<script src="libs/kePrint-0.0.1/kePrint.js"></script>
<link href="libs/lightable-0.0.1/lightable.css" rel="stylesheet" />
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/str_view-0.1.0/str_view.css" rel="stylesheet" />
<script src="libs/str_view-binding-1.4.0/str_view.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Readings for Data Wrangling in R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a></li>
<li class="chapter" data-level="1" data-path="preparation.html"><a href="preparation.html"><i class="fa fa-check"></i><b>1</b> Preparation</a>
<ul>
<li class="chapter" data-level="1.1" data-path="preparation.html"><a href="preparation.html#installing-r-and-rstudio"><i class="fa fa-check"></i><b>1.1</b> Installing R and RStudio</a></li>
<li class="chapter" data-level="1.2" data-path="preparation.html"><a href="preparation.html#optimally-configuring-rstudio"><i class="fa fa-check"></i><b>1.2</b> Optimally Configuring RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="preparation.html"><a href="preparation.html#install-tidyverse-and-other-packages"><i class="fa fa-check"></i><b>1.3</b> Install Tidyverse and Other Packages</a></li>
<li class="chapter" data-level="1.4" data-path="preparation.html"><a href="preparation.html#rstudio-projects"><i class="fa fa-check"></i><b>1.4</b> RStudio Projects</a></li>
<li class="chapter" data-level="1.5" data-path="preparation.html"><a href="preparation.html#using-the-notebook-template"><i class="fa fa-check"></i><b>1.5</b> Using the Notebook Template</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Data Structures</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#vectors"><i class="fa fa-check"></i><b>2.1</b> Vectors</a></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#data-classes"><i class="fa fa-check"></i><b>2.2</b> Data Classes</a></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#data-frames"><i class="fa fa-check"></i><b>2.3</b> Data Frames</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#tidy-data"><i class="fa fa-check"></i><b>2.4</b> Tidy Data</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="read-external-data-files.html"><a href="read-external-data-files.html"><i class="fa fa-check"></i><b>3</b> Read External Data Files</a>
<ul>
<li class="chapter" data-level="3.1" data-path="read-external-data-files.html"><a href="read-external-data-files.html#entering-data"><i class="fa fa-check"></i><b>3.1</b> Entering Data</a></li>
<li class="chapter" data-level="3.2" data-path="read-external-data-files.html"><a href="read-external-data-files.html#saving-the-external-file"><i class="fa fa-check"></i><b>3.2</b> Saving the External File</a></li>
<li class="chapter" data-level="3.3" data-path="read-external-data-files.html"><a href="read-external-data-files.html#reading-an-external-file"><i class="fa fa-check"></i><b>3.3</b> Reading an External File</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="relational-data.html"><a href="relational-data.html"><i class="fa fa-check"></i><b>4</b> Relational Data</a>
<ul>
<li class="chapter" data-level="4.1" data-path="relational-data.html"><a href="relational-data.html#nature-of-relational-data"><i class="fa fa-check"></i><b>4.1</b> Nature of Relational Data</a></li>
<li class="chapter" data-level="4.2" data-path="relational-data.html"><a href="relational-data.html#join-concepts"><i class="fa fa-check"></i><b>4.2</b> Join Concepts</a></li>
<li class="chapter" data-level="4.3" data-path="relational-data.html"><a href="relational-data.html#joins-in-r"><i class="fa fa-check"></i><b>4.3</b> Joins in R</a></li>
<li class="chapter" data-level="4.4" data-path="relational-data.html"><a href="relational-data.html#examples-with-context"><i class="fa fa-check"></i><b>4.4</b> Examples With Context</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="pivot.html"><a href="pivot.html"><i class="fa fa-check"></i><b>5</b> Pivot</a>
<ul>
<li class="chapter" data-level="5.1" data-path="pivot.html"><a href="pivot.html#data-formats"><i class="fa fa-check"></i><b>5.1</b> Data Formats</a></li>
<li class="chapter" data-level="5.2" data-path="pivot.html"><a href="pivot.html#pivoting-concepts"><i class="fa fa-check"></i><b>5.2</b> Pivoting Concepts</a></li>
<li class="chapter" data-level="5.3" data-path="pivot.html"><a href="pivot.html#pivoting-in-r"><i class="fa fa-check"></i><b>5.3</b> Pivoting in R</a></li>
<li class="chapter" data-level="5.4" data-path="pivot.html"><a href="pivot.html#pivoting-examples"><i class="fa fa-check"></i><b>5.4</b> Examples with Context</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="wrangle-columns.html"><a href="wrangle-columns.html"><i class="fa fa-check"></i><b>6</b> Wrangle Columns</a>
<ul>
<li class="chapter" data-level="6.1" data-path="wrangle-columns.html"><a href="wrangle-columns.html#dplyr-verbs"><i class="fa fa-check"></i><b>6.1</b> <code>dplyr</code> verbs</a></li>
<li class="chapter" data-level="6.2" data-path="wrangle-columns.html"><a href="wrangle-columns.html#pipe"><i class="fa fa-check"></i><b>6.2</b> Pipe</a></li>
<li class="chapter" data-level="6.3" data-path="wrangle-columns.html"><a href="wrangle-columns.html#selecting-variables"><i class="fa fa-check"></i><b>6.3</b> Selecting Variables</a></li>
<li class="chapter" data-level="6.4" data-path="wrangle-columns.html"><a href="wrangle-columns.html#moving-variables"><i class="fa fa-check"></i><b>6.4</b> Moving Variables</a></li>
<li class="chapter" data-level="6.5" data-path="wrangle-columns.html"><a href="wrangle-columns.html#renaming-variables"><i class="fa fa-check"></i><b>6.5</b> Renaming Variables</a></li>
<li class="chapter" data-level="6.6" data-path="wrangle-columns.html"><a href="wrangle-columns.html#adding-variables"><i class="fa fa-check"></i><b>6.6</b> Adding Variables</a></li>
<li class="chapter" data-level="6.7" data-path="wrangle-columns.html"><a href="wrangle-columns.html#columns-examples"><i class="fa fa-check"></i><b>6.7</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="wrangle-rows.html"><a href="wrangle-rows.html"><i class="fa fa-check"></i><b>7</b> Wrangle Rows</a>
<ul>
<li class="chapter" data-level="7.1" data-path="wrangle-rows.html"><a href="wrangle-rows.html#selecting-specific-rows"><i class="fa fa-check"></i><b>7.1</b> Selecting Specific Rows</a></li>
<li class="chapter" data-level="7.2" data-path="wrangle-rows.html"><a href="wrangle-rows.html#filtering-rows"><i class="fa fa-check"></i><b>7.2</b> Filtering Rows</a></li>
<li class="chapter" data-level="7.3" data-path="wrangle-rows.html"><a href="wrangle-rows.html#arranging-rows"><i class="fa fa-check"></i><b>7.3</b> Arranging Rows</a></li>
<li class="chapter" data-level="7.4" data-path="wrangle-rows.html"><a href="wrangle-rows.html#appending-rows"><i class="fa fa-check"></i><b>7.4</b> Appending Rows</a></li>
<li class="chapter" data-level="7.5" data-path="wrangle-rows.html"><a href="wrangle-rows.html#examples-in-context"><i class="fa fa-check"></i><b>7.5</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="groupings.html"><a href="groupings.html"><i class="fa fa-check"></i><b>8</b> Groupings</a>
<ul>
<li class="chapter" data-level="8.1" data-path="groupings.html"><a href="groupings.html#declaring-groupings"><i class="fa fa-check"></i><b>8.1</b> Declaring Groupings</a></li>
<li class="chapter" data-level="8.2" data-path="groupings.html"><a href="groupings.html#summarizing-by-groups"><i class="fa fa-check"></i><b>8.2</b> Summarizing by Groups</a></li>
<li class="chapter" data-level="8.3" data-path="groupings.html"><a href="groupings.html#wrangling-by-group"><i class="fa fa-check"></i><b>8.3</b> Wrangling by Group</a></li>
<li class="chapter" data-level="8.4" data-path="groupings.html"><a href="groupings.html#ungrouping"><i class="fa fa-check"></i><b>8.4</b> Ungrouping</a></li>
<li class="chapter" data-level="8.5" data-path="groupings.html"><a href="groupings.html#examples-in-context-1"><i class="fa fa-check"></i><b>8.5</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="dates-and-times.html"><a href="dates-and-times.html"><i class="fa fa-check"></i><b>9</b> Dates and Times</a>
<ul>
<li class="chapter" data-level="9.1" data-path="dates-and-times.html"><a href="dates-and-times.html#obtaining-dates-data"><i class="fa fa-check"></i><b>9.1</b> Obtaining Dates Data</a></li>
<li class="chapter" data-level="9.2" data-path="dates-and-times.html"><a href="dates-and-times.html#extracting-date-components"><i class="fa fa-check"></i><b>9.2</b> Extracting Date Components</a></li>
<li class="chapter" data-level="9.3" data-path="dates-and-times.html"><a href="dates-and-times.html#calculations-with-dates"><i class="fa fa-check"></i><b>9.3</b> Calculations with Dates</a></li>
<li class="chapter" data-level="9.4" data-path="dates-and-times.html"><a href="dates-and-times.html#obtaining-time-data"><i class="fa fa-check"></i><b>9.4</b> Obtaining Time Data</a></li>
<li class="chapter" data-level="9.5" data-path="dates-and-times.html"><a href="dates-and-times.html#extracting-time-components"><i class="fa fa-check"></i><b>9.5</b> Extracting Time Components</a></li>
<li class="chapter" data-level="9.6" data-path="dates-and-times.html"><a href="dates-and-times.html#calculations-with-date-times"><i class="fa fa-check"></i><b>9.6</b> Calculations with Date-Times</a></li>
<li class="chapter" data-level="9.7" data-path="dates-and-times.html"><a href="dates-and-times.html#examples-in-context-2"><i class="fa fa-check"></i><b>9.7</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="factors.html"><a href="factors.html"><i class="fa fa-check"></i><b>10</b> Factors</a>
<ul>
<li class="chapter" data-level="10.1" data-path="factors.html"><a href="factors.html#creating-factors"><i class="fa fa-check"></i><b>10.1</b> Creating Factors</a></li>
<li class="chapter" data-level="10.2" data-path="factors.html"><a href="factors.html#changing-factor-order"><i class="fa fa-check"></i><b>10.2</b> Changing Factor Order</a></li>
<li class="chapter" data-level="10.3" data-path="factors.html"><a href="factors.html#changing-factor-levels"><i class="fa fa-check"></i><b>10.3</b> Changing Factor Levels</a></li>
<li class="chapter" data-level="10.4" data-path="factors.html"><a href="factors.html#examples-in-context-3"><i class="fa fa-check"></i><b>10.4</b> Examples in Context</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="strings.html"><a href="strings.html"><i class="fa fa-check"></i><b>11</b> Strings</a></li>
<li class="divider"></li>
<li><a rel="license" href="http://creativecommons.org/licenses/by-nc-nd/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-nd/4.0/88x31.png" /></a></li>
<li><a href="https://bookdown.org" target="_blank">Built with Bookdown + RStudio</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Readings for MTH250 - Data Wrangling</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="pivot" class="section level1" number="5">
<h1><span class="header-section-number">Module 5</span> Pivot</h1>
<p>Three rules of tidy data were introduced in Section <a href="data-structures.html#tidy-data">2.4</a>.</p>
<ol style="list-style-type: decimal">
<li>Each variable must have its own column.</li>
<li>Each observation must have its own row.</li>
<li>Each value must have its own cell.</li>
</ol>
<p>There are a wide variety of ways to enter data. Some data will not be tidy because, for instance, it may be easier to enter data in a non-tidy format. For example, the data shown below is the number of positive confirmed COVID cases in Ashland, Bayfield, and Douglas counties in 2021 (through June).</p>
<p> </p>
<table class=" lightable-minimal table table-hover table-condensed" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto;">
<thead>
<tr>
<th style="text-align:center;font-weight: bold;">
County
</th>
<th style="text-align:center;font-weight: bold;">
Jan_2021
</th>
<th style="text-align:center;font-weight: bold;">
Feb_2021
</th>
<th style="text-align:center;font-weight: bold;">
Mar_2021
</th>
<th style="text-align:center;font-weight: bold;">
Apr_2021
</th>
<th style="text-align:center;font-weight: bold;">
May_2021
</th>
<th style="text-align:center;font-weight: bold;">
Jun_2021
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;font-weight: bold;">
Ashland
</td>
<td style="text-align:center;">
139
</td>
<td style="text-align:center;">
27
</td>
<td style="text-align:center;">
31
</td>
<td style="text-align:center;">
41
</td>
<td style="text-align:center;">
45
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;font-weight: bold;">
Bayfield
</td>
<td style="text-align:center;">
100
</td>
<td style="text-align:center;">
33
</td>
<td style="text-align:center;">
28
</td>
<td style="text-align:center;">
54
</td>
<td style="text-align:center;">
36
</td>
<td style="text-align:center;">
15
</td>
</tr>
<tr>
<td style="text-align:center;font-weight: bold;">
Douglas
</td>
<td style="text-align:center;">
470
</td>
<td style="text-align:center;">
89
</td>
<td style="text-align:center;">
119
</td>
<td style="text-align:center;">
227
</td>
<td style="text-align:center;">
148
</td>
<td style="text-align:center;">
32
</td>
</tr>
</tbody>
</table>
<p> </p>
<p>Data for future months can be easily entered by simply appending a new month on the right. These data are also easy to examine in this table, but in this format they are difficult to graph and can be difficult to summarize. Thus, these data need to be converted to a different format for some simple analyses.<a href="#fn19" class="footnote-ref" id="fnref19"><sup>19</sup></a></p>
<p>The objective of this module is to describe and demonstrate concepts and methods for converting data between two common formats.</p>
<div id="data-formats" class="section level2" number="5.1">
<h2><span class="header-section-number">5.1</span> Data Formats</h2>
<p>Consider a situation with one measurement variable, <code>x</code>, recorded on four individuals at two times. These eight measurements could be entered in either the <code>W</code> or <code>L</code> data frames shown below.</p>
<table class=" lightable-minimal table table-hover table-condensed table" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto; float: left; margin-right: 10px;">
<thead>
<tr>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
‘W’ data.frame
</div>
</th>
</tr>
<tr>
<th style="text-align:center;font-weight: bold;">
id
</th>
<th style="text-align:center;font-weight: bold;">
x1
</th>
<th style="text-align:center;font-weight: bold;">
x2
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
6
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
8
</td>
</tr>
</tbody>
</table>
<table class=" lightable-minimal table table-hover table-condensed table" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto; margin-right: 0; margin-left: auto">
<thead>
<tr>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
‘L’ data.frame
</div>
</th>
</tr>
<tr>
<th style="text-align:center;font-weight: bold;">
id
</th>
<th style="text-align:center;font-weight: bold;">
time
</th>
<th style="text-align:center;font-weight: bold;">
x
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
6
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
4
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
8
</td>
</tr>
</tbody>
</table>
<!-- for clearing the floats from above -->
<div style="clear:both;">

</div>
<p> </p>
<p>In this case, a measurement of <code>x</code> on an individual at a single point in time is an observation; thus, each row should correspond to one measurement (value of <code>x</code>) on one individual. The <code>W</code> data frame is not tidy because multiple observations of <code>x</code> appear in each row of the data frame (i.e., the single measurement variable, <code>x</code>, is dispersed across two columns). The <code>L</code> data frame is tidy because each row corresponds to one observation (i.e., a unique combination of <code>id</code> and <code>time</code>) and the single measurement variable, <code>x</code>, now appears in only one column.</p>
<p>Consider a similar example where <em>two measurements</em> (the variables <code>x</code> and <code>y</code>) were made (at the same time) on four individuals. These data may be entered as in <code>V</code> and <code>Z</code> below.</p>
<table class=" lightable-minimal table table-hover table-condensed table" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto; float: left; margin-right: 10px;">
<thead>
<tr>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
‘V’ data.frame
</div>
</th>
</tr>
<tr>
<th style="text-align:center;font-weight: bold;">
id
</th>
<th style="text-align:center;font-weight: bold;">
x
</th>
<th style="text-align:center;font-weight: bold;">
y
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
1
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
2
</td>
<td style="text-align:center;">
6
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
3
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
4
</td>
<td style="text-align:center;">
8
</td>
</tr>
</tbody>
</table>
<table class=" lightable-minimal table table-hover table-condensed table" style="font-family: Cambria; width: auto !important; margin-left: auto; margin-right: auto; margin-left: auto; margin-right: auto; margin-right: 0; margin-left: auto">
<thead>
<tr>
<th style="padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; " colspan="3">
<div style="border-bottom: 2px solid #00000050; ">
‘Z’ data.frame
</div>
</th>
</tr>
<tr>
<th style="text-align:center;font-weight: bold;">
id
</th>
<th style="text-align:center;font-weight: bold;">
variable
</th>
<th style="text-align:center;font-weight: bold;">
value
</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
x
</td>
<td style="text-align:center;">
1
</td>
</tr>
<tr>
<td style="text-align:center;">
A
</td>
<td style="text-align:center;">
y
</td>
<td style="text-align:center;">
5
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
x
</td>
<td style="text-align:center;">
2
</td>
</tr>
<tr>
<td style="text-align:center;">
B
</td>
<td style="text-align:center;">
y
</td>
<td style="text-align:center;">
6
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
x
</td>
<td style="text-align:center;">
3
</td>
</tr>
<tr>
<td style="text-align:center;">
C
</td>
<td style="text-align:center;">
y
</td>
<td style="text-align:center;">
7
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
x
</td>
<td style="text-align:center;">
4
</td>
</tr>
<tr>
<td style="text-align:center;">
D
</td>
<td style="text-align:center;">
y
</td>
<td style="text-align:center;">
8
</td>
</tr>
</tbody>
</table>
<!-- for clearing the floats from above -->
<div style="clear:both;">

</div>
<p> </p>
<p>In this case <code>V</code> is tidy because each row corresponds to one observation (defined only by <code>id</code>) and each measurement variable (<code>x</code> and <code>y</code>) is in its own column. On the other hand <code>Z</code> is not tidy because observations are split into two rows and values of the two different measurement variables are lumped into the same column.</p>
<p> </p>
<p>As you can see it can be difficult to identify the format that you want for your data. You cannot tell simply by the “shape” of the data – there will be times when you need the data to be “longer” (as in the first example above) and other times when you need the data to be “wider” (as in the second example above).</p>
<p>As a general rule you should strive for your data to be tidy. To identify tidy data, identify what an observation is, which variables define the observations, and what the measurement variable(s) is/are. Then determine if each row corresponds to one observation and if each measurement variable is in one column by itself. If the data do not meet these requirements then you likely need to convert it to a different format as described in the next sections.</p>
<p> </p>
</div>
<div id="pivoting-concepts" class="section level2" number="5.2">
<h2><span class="header-section-number">5.2</span> Pivoting Concepts</h2>
<p>Each set of data described in the previous section could be entered in two formats. These formats are loosely called “wider” and “longer” based on their shapes relative to each other. Converting between wider and longer format data is called a <strong>pivot</strong>.</p>
<div id="pivot-longer" class="section level3" number="5.2.1">
<h3><span class="header-section-number">5.2.1</span> Pivot Longer</h3>
<p>“Pivot Longer” is the conversion from a “wider” to a “longer” format. Pivoting to a longer format is usually needed if multiple observations of the same variable are recorded on individuals but are stored in separate columns of the data frame. This was the case with <code>W</code> above and also with the COVID data in the module introduction.</p>
<p>To pivot from a wider to a longer format you must identify the variables in the wider format that contain the multiple measurements of the same variable. This was <code>x1</code> and <code>x2</code> in <code>W</code>. All other variables in the data frame are considered to represent a unique individual. In this case only the <code>id</code> variable is needed for this purpose.</p>
<p>In addition, you must define names for variables in what will be the new longer format. The first name is for the variable that will identify the multiple measurements on the same individual. In this example the multiple measurements were taken at different times, so it seems logical to call the new variable <code>time</code>. The second name is for the variable that will hold the values of the measurement variable. Here the use of <code>x1</code> and <code>x2</code> in the original wider data frame suggest that this variable should be called <code>x</code>.</p>
<p>The process of pivoting the wider <code>W</code> to a longer data frame is illustrated below.</p>
<p> </p>
<p><img src="BookWrangling_files/figure-html/unnamed-chunk-93-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="tip">
<p>To pivot from a “wider” to a “longer” format, you must …</p>
<ol style="list-style-type: decimal">
<li>Identify the variables in the wider format data that contain the multiple measurements of the same variable. This will be <code class="inline">cols=</code> in Section <a href="pivot.html#pivot-longer-1">5.3.1</a>.</li>
<li>Define a name for the variable in the new longer format that will identify the multiple measurements on the same individual. This will be <code class="inline">names_to=</code> in Section <a href="pivot.html#pivot-longer-1">5.3.1</a>.</li>
<li>Define a name for the variable in the new longer format that will hold the values of the measurement variable. This will be <code class="inline">values_to=</code> in Section <a href="pivot.html#pivot-longer-1">5.3.1</a>.</li>
</ol>
</div>
</div>
<div id="pivot-wider" class="section level3" number="5.2.2">
<h3><span class="header-section-number">5.2.2</span> Pivot Wider</h3>
<p>“Pivot Wider” is the conversion from a “longer” to a “wider” format. Pivoting to a wider format is most common when multiple measurement variables are recorded as one variable in the longer format. This was the case with <code>Z</code> from above.</p>
<p>To pivot from a longer to a wider format you must identify the variable in the longer format that contains what will be names of variables in the wider format. The wider format that will be created from <code>Z</code> should have <code>x</code> and <code>y</code> as names of variables; thus, this variable in <code>Z</code> is <code>variable</code>. In addition, you must identify the variable in the longer format that has the values of the measurement variable that will be separated into columns in the wider format. In <code>Z</code> this variable is <code>value</code>.</p>
<p>The process of pivoting the longer <code>Z</code> to a wider format is illustrated below.</p>
<p> </p>
<p><img src="BookWrangling_files/figure-html/unnamed-chunk-94-1.png" width="672" style="display: block; margin: auto;" /></p>
<div class="tip">
<p>To pivot from a “longer” to a “wider” format, you must …</p>
<ol style="list-style-type: decimal">
<li>Identify the variable in the longer format that contains the names of the new variables in the new wider format. This will be <code class="inline">names_from=</code> in Section <a href="pivot.html#pivot-wider-1">5.3.2</a>.</li>
<li>Identify the variable in the longer format that contains all of the values of the measurement variable. This will be <code class="inline">values_from=</code> in Section <a href="pivot.html#pivot-wider-1">5.3.2</a>.</li>
</ol>
</div>
<p> </p>
</div>
</div>
<div id="pivoting-in-r" class="section level2" number="5.3">
<h2><span class="header-section-number">5.3</span> Pivoting in R</h2>
<p>Pivoting <code>W</code> to a longer format and <code>Z</code> to a wider format in R are demonstrated in this section. These two data frames are created in R below.</p>
<div class="sourceCode" id="cb149"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb149-1"><a href="pivot.html#cb149-1" aria-hidden="true" tabindex="-1"></a>W <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id=</span><span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>),</span>
<span id="cb149-2"><a href="pivot.html#cb149-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">x1=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>,</span>
<span id="cb149-3"><a href="pivot.html#cb149-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">x2=</span><span class="dv">5</span><span class="sc">:</span><span class="dv">8</span>)</span>
<span id="cb149-4"><a href="pivot.html#cb149-4" aria-hidden="true" tabindex="-1"></a>W</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 4 x 3
#R&gt;    id       x1    x2
#R&gt;    &lt;chr&gt; &lt;int&gt; &lt;int&gt;
#R&gt;  1 A         1     5
#R&gt;  2 B         2     6
#R&gt;  3 C         3     7
#R&gt;  4 D         4     8</code></pre>
<div class="sourceCode" id="cb151"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb151-1"><a href="pivot.html#cb151-1" aria-hidden="true" tabindex="-1"></a>Z <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">id=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;A&quot;</span>,<span class="st">&quot;B&quot;</span>,<span class="st">&quot;C&quot;</span>,<span class="st">&quot;D&quot;</span>),<span class="at">each=</span><span class="dv">2</span>),</span>
<span id="cb151-2"><a href="pivot.html#cb151-2" aria-hidden="true" tabindex="-1"></a>            <span class="at">variable=</span><span class="fu">rep</span>(<span class="fu">c</span>(<span class="st">&quot;x&quot;</span>,<span class="st">&quot;y&quot;</span>),<span class="at">times=</span><span class="dv">4</span>),</span>
<span id="cb151-3"><a href="pivot.html#cb151-3" aria-hidden="true" tabindex="-1"></a>            <span class="at">value=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">6</span>,<span class="dv">3</span>,<span class="dv">7</span>,<span class="dv">4</span>,<span class="dv">8</span>))</span>
<span id="cb151-4"><a href="pivot.html#cb151-4" aria-hidden="true" tabindex="-1"></a>Z</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 8 x 3
#R&gt;    id    variable value
#R&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;
#R&gt;  1 A     x            1
#R&gt;  2 A     y            5
#R&gt;  3 B     x            2
#R&gt;  4 B     y            6
#R&gt;  5 C     x            3
#R&gt;  6 C     y            7
#R&gt;  7 D     x            4
#R&gt;  8 D     y            8</code></pre>
<div id="pivot-longer-1" class="section level3" number="5.3.1">
<h3><span class="header-section-number">5.3.1</span> Pivot Longer</h3>
<p>Pivoting to a longer data frame is accomplished with <code class="inline">pivot_longer()</code> from <code>tidyr</code> (which is part of <code>tidyverse</code>). The first argument is the name of the wider data frame. The following three arguments are also typically used.</p>
<ul>
<li>The variables in the wider data frame that represent multiple measurements of the same variable must be given in <code class="inline">cols=</code>. Note that these variables do NOT need to be in quotes because they exist in the wider data frame. There are multiple ways to select these variables in most situations; here are several for this situation.<a href="#fn20" class="footnote-ref" id="fnref20"><sup>20</sup></a>
<ul>
<li><code class="inline">cols=x1:x2</code> will select all variables contiguous from between <code>x1</code> to <code>x2</code>.</li>
<li><code class="inline">cols=c(x1,x2)</code> will select only variables <code>x1</code> and <code>x2</code>.</li>
<li><code class="inline">cols=starts_with("x")</code> will select all variables with names that begin with <code>x</code>.</li>
<li><code class="inline">cols=-id</code> will select all variables not named <code>id</code>.</li>
</ul></li>
<li>The name for the variable in the new longer data frame that will hold the index for multiple measurements on the same individual in the longer data frame is given in <code class="inline">names_to=</code>.</li>
<li>The name for the variable that will hold the values of the measurement variable in the new longer data frame is given in <code class="inline">values_to</code>.</li>
</ul>
<p>Note that the variable names in <code class="inline">names_to=</code> and <code class="inline">values_to=</code> must be in quotes because they do not yet exist in the new data frame.</p>
<p>Given the definitions of these items in Section <a href="pivot.html#pivot-longer">5.2.1</a>, the following code is used to pivot <code>W</code> to a longer format data frame, <code>L</code>.</p>
<div class="sourceCode" id="cb153"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb153-1"><a href="pivot.html#cb153-1" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(W,<span class="at">cols=</span>x1<span class="sc">:</span>x2,<span class="at">names_to=</span><span class="st">&quot;time&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;x&quot;</span>)</span>
<span id="cb153-2"><a href="pivot.html#cb153-2" aria-hidden="true" tabindex="-1"></a>L</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 8 x 3
#R&gt;    id    time      x
#R&gt;    &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
#R&gt;  1 A     x1        1
#R&gt;  2 A     x2        5
#R&gt;  3 B     x1        2
#R&gt;  4 B     x2        6
#R&gt;  5 C     x1        3
#R&gt;  6 C     x2        7
#R&gt;  7 D     x1        4
#R&gt;  8 D     x2        8</code></pre>
<p>Note, however, that the <code>time</code> variable in <code>L</code> contains <code>x1</code> and <code>x2</code> rather than <code>1</code> and <code>2</code>. By default <code class="inline">pivot_longer()</code> uses the names of the variables you supplied in <code class="inline">cols=</code> for this variable. If these variables have a common pattern – as in they all start with “x” and end with the number that we want – then the portion of the pattern to remove can be given in <code class="inline">names_prefix=</code>.<a href="#fn21" class="footnote-ref" id="fnref21"><sup>21</sup></a></p>
<div class="sourceCode" id="cb155"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb155-1"><a href="pivot.html#cb155-1" aria-hidden="true" tabindex="-1"></a>L <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(W,<span class="at">cols=</span>x1<span class="sc">:</span>x2,<span class="at">names_to=</span><span class="st">&quot;time&quot;</span>,<span class="at">names_prefix=</span><span class="st">&quot;x&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;x&quot;</span>)</span>
<span id="cb155-2"><a href="pivot.html#cb155-2" aria-hidden="true" tabindex="-1"></a>L</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 8 x 3
#R&gt;    id    time      x
#R&gt;    &lt;chr&gt; &lt;chr&gt; &lt;int&gt;
#R&gt;  1 A     1         1
#R&gt;  2 A     2         5
#R&gt;  3 B     1         2
#R&gt;  4 B     2         6
#R&gt;  5 C     1         3
#R&gt;  6 C     2         7
#R&gt;  7 D     1         4
#R&gt;  8 D     2         8</code></pre>
<p> </p>
<p>A reminder that all variables not given in <code class="inline">cols=</code> will be considered as identifying with the individuals in the data frame. Suppose for example that <code>W</code> had more columns like this data frame <code>W2</code>.</p>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 4 x 6
#R&gt;    id    fname  lname    years    x1    x2
#R&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt; &lt;int&gt; &lt;int&gt;
#R&gt;  1 A     Derek  Ogle        25     1     5
#R&gt;  2 B     Young  Kim         32     2     6
#R&gt;  3 C     Andrew Jensen       6     3     7
#R&gt;  4 D     Jodi   Supanich     7     4     8</code></pre>
<p>The same <code class="inline">pivot_longer()</code> with <code>W2</code> will repeat the <code>id</code>, <code>fname</code>, <code>lname</code>, and <code>years</code> values in the longer data frame <code>L2</code>.</p>
<div class="sourceCode" id="cb158"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb158-1"><a href="pivot.html#cb158-1" aria-hidden="true" tabindex="-1"></a>L2 <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(W2,<span class="at">cols=</span>x1<span class="sc">:</span>x2,<span class="at">names_to=</span><span class="st">&quot;time&quot;</span>,<span class="at">names_prefix=</span><span class="st">&quot;x&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;x&quot;</span>)</span>
<span id="cb158-2"><a href="pivot.html#cb158-2" aria-hidden="true" tabindex="-1"></a>L2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 8 x 6
#R&gt;    id    fname  lname    years time      x
#R&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;dbl&gt; &lt;chr&gt; &lt;int&gt;
#R&gt;  1 A     Derek  Ogle        25 1         1
#R&gt;  2 A     Derek  Ogle        25 2         5
#R&gt;  3 B     Young  Kim         32 1         2
#R&gt;  4 B     Young  Kim         32 2         6
#R&gt;  5 C     Andrew Jensen       6 1         3
#R&gt;  6 C     Andrew Jensen       6 2         7
#R&gt;  7 D     Jodi   Supanich     7 1         4
#R&gt;  8 D     Jodi   Supanich     7 2         8</code></pre>
<p> </p>
</div>
<div id="pivot-wider-1" class="section level3" number="5.3.2">
<h3><span class="header-section-number">5.3.2</span> Pivot Wider</h3>
<p>Pivoting to a wider data frame is accomplished with <code class="inline">pivot_wider()</code> from <code>tidyr</code>. The first argument is the name of the longer data frame. The following two arguments are also typically used.</p>
<ul>
<li>The name of the variable in the longer data frame that contains what will be names of variables in the wider data frame is given in <code class="inline">names_from=</code>.</li>
<li>The name of the variable in the longer data frame that has values of the measurement variable that will be separated into columns in the new data frame is given in <code class="inline">values_from=</code>.</li>
</ul>
<p>As both of these variables exist in the longer data frame they do NOT need to be in quotes.</p>
<p>Given the definitions from Section <a href="pivot.html#pivot-wider">5.2.2</a>, the following is used to pivot <code>Z</code> to a wider format, <code>V</code>.</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb160-1"><a href="pivot.html#cb160-1" aria-hidden="true" tabindex="-1"></a>V <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(Z,<span class="at">names_from=</span>variable,<span class="at">values_from=</span>value)</span>
<span id="cb160-2"><a href="pivot.html#cb160-2" aria-hidden="true" tabindex="-1"></a>V</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 4 x 3
#R&gt;    id        x     y
#R&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;  1 A         1     5
#R&gt;  2 B         2     6
#R&gt;  3 C         3     7
#R&gt;  4 D         4     8</code></pre>
<p> </p>
<p>Again, you can imagine a slightly more complicated data frame (here called <code>Z2</code>).</p>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 8 x 6
#R&gt;    id    fname  lname    years variable value
#R&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;    &lt;dbl&gt;
#R&gt;  1 A     Derek  Ogle     25    x            1
#R&gt;  2 A     Derek  Ogle     25    y            5
#R&gt;  3 B     Young  Kim      32    x            2
#R&gt;  4 B     Young  Kim      32    y            6
#R&gt;  5 C     Andrew Jensen   6     x            3
#R&gt;  6 C     Andrew Jensen   6     y            7
#R&gt;  7 D     Jodi   Supanich 7     x            4
#R&gt;  8 D     Jodi   Supanich 7     y            8</code></pre>
<p>The same <code class="inline">pivot_wider()</code> on <code>Z2</code> will collapse the common <code>id</code>, <code>fname</code>, <code>lname</code>, and <code>years</code> variables.</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb163-1"><a href="pivot.html#cb163-1" aria-hidden="true" tabindex="-1"></a>V2 <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(Z2,<span class="at">names_from=</span>variable,<span class="at">values_from=</span>value)</span>
<span id="cb163-2"><a href="pivot.html#cb163-2" aria-hidden="true" tabindex="-1"></a>V2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 4 x 6
#R&gt;    id    fname  lname    years     x     y
#R&gt;    &lt;chr&gt; &lt;chr&gt;  &lt;chr&gt;    &lt;chr&gt; &lt;dbl&gt; &lt;dbl&gt;
#R&gt;  1 A     Derek  Ogle     25        1     5
#R&gt;  2 B     Young  Kim      32        2     6
#R&gt;  3 C     Andrew Jensen   6         3     7
#R&gt;  4 D     Jodi   Supanich 7         4     8</code></pre>
<p> </p>
</div>
</div>
<div id="pivoting-examples" class="section level2" number="5.4">
<h2><span class="header-section-number">5.4</span> Examples with Context</h2>
<div id="pivoting-covid" class="section level3" number="5.4.1">
<h3><span class="header-section-number">5.4.1</span> COVID Cases by County and Month</h3>
<p>A simple data frame of COVID cases by month in three Wisconsin counties from January to June 2021 was shown in the introduction. Here consider an even wider data, <code>covABD_W</code>, of monthly cases for all three counties from March 2020 to June 2021.</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb165-1"><a href="pivot.html#cb165-1" aria-hidden="true" tabindex="-1"></a>covABD_W</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 3 x 17
#R&gt;  # Groups:   County [3]
#R&gt;    County   Mar_2020 Apr_2020 May_2020 Jun_2020 Jul_2020 Aug_2020 Sep_2020 Oct_2020
#R&gt;    &lt;chr&gt;       &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;    &lt;dbl&gt;
#R&gt;  1 Ashland         1        1        0        1       16       16       94      167
#R&gt;  2 Bayfield        3        0        0        0       16       26       71      160
#R&gt;  3 Douglas         6        3       10       11       93      133      268      316
#R&gt;  # ... with 8 more variables: Nov_2020 &lt;dbl&gt;, Dec_2020 &lt;dbl&gt;, Jan_2021 &lt;dbl&gt;,
#R&gt;  #   Feb_2021 &lt;dbl&gt;, Mar_2021 &lt;dbl&gt;, Apr_2021 &lt;dbl&gt;, May_2021 &lt;dbl&gt;,
#R&gt;  #   Jun_2021 &lt;dbl&gt;</code></pre>
<p>In this case a “measurement” is number of COVID cases and an observation is a combination of month and county. Thus, these data are not tidy because number of COVID cases is not in one column and each row is not one combination of county and month. It would be difficult to plot number of cases by month for each county with data in this format. Thus these “wider” data need to be converted to “longer” data that are tidy.</p>
<p>All columns except <code>County</code> are part of the data to pivot; thus, <code class="inline">cols=-County</code> is the easiest way to choose those columns. The variable names in <code>covABD_W</code> are the month and year of the data so I will call the <code class="inline">names_to=</code> variable “MonYear.” Finally, the measurements are of cases of COVID so I will call the <code class="inline">values_to=</code> variable “Cases.” Putting this together gives the following.</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb167-1"><a href="pivot.html#cb167-1" aria-hidden="true" tabindex="-1"></a>covABD_L <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(covABD_W,<span class="at">cols=</span><span class="sc">-</span>County,<span class="at">names_to=</span><span class="st">&quot;MonYear&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;Cases&quot;</span>)</span>
<span id="cb167-2"><a href="pivot.html#cb167-2" aria-hidden="true" tabindex="-1"></a>covABD_L</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 48 x 3
#R&gt;  # Groups:   County [3]
#R&gt;     County  MonYear  Cases
#R&gt;     &lt;chr&gt;   &lt;chr&gt;    &lt;dbl&gt;
#R&gt;   1 Ashland Mar_2020     1
#R&gt;   2 Ashland Apr_2020     1
#R&gt;   3 Ashland May_2020     0
#R&gt;   4 Ashland Jun_2020     1
#R&gt;   5 Ashland Jul_2020    16
#R&gt;   6 Ashland Aug_2020    16
#R&gt;   7 Ashland Sep_2020    94
#R&gt;   8 Ashland Oct_2020   167
#R&gt;   9 Ashland Nov_2020   378
#R&gt;  10 Ashland Dec_2020   331
#R&gt;  # ... with 38 more rows</code></pre>
<p>This worked but the <code>MonYear</code> variable is problematic because R does not recognize it as a date (note how it is identified as character class). It would be better to split these names on the underscore to get one variable with the months and one variable with the years. Names may be split in <code class="inline">pivot_longer()</code> by providing the character to split on in <code class="inline">names_sep=</code>. As splitting the names will produce two new variables, <code class="inline">names_to=</code> must be a vector with two names for these two new columns. These modifications produce the following result.</p>
<div class="sourceCode" id="cb169"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb169-1"><a href="pivot.html#cb169-1" aria-hidden="true" tabindex="-1"></a>covABD_L <span class="ot">&lt;-</span> <span class="fu">pivot_longer</span>(covABD_W,<span class="at">cols=</span><span class="sc">-</span>County,</span>
<span id="cb169-2"><a href="pivot.html#cb169-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">names_to=</span><span class="fu">c</span>(<span class="st">&quot;Month&quot;</span>,<span class="st">&quot;Year&quot;</span>),<span class="at">names_sep=</span><span class="st">&quot;_&quot;</span>,<span class="at">values_to=</span><span class="st">&quot;Cases&quot;</span>)</span>
<span id="cb169-3"><a href="pivot.html#cb169-3" aria-hidden="true" tabindex="-1"></a>covABD_L</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 48 x 4
#R&gt;  # Groups:   County [3]
#R&gt;     County  Month Year  Cases
#R&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt;
#R&gt;   1 Ashland Mar   2020      1
#R&gt;   2 Ashland Apr   2020      1
#R&gt;   3 Ashland May   2020      0
#R&gt;   4 Ashland Jun   2020      1
#R&gt;   5 Ashland Jul   2020     16
#R&gt;   6 Ashland Aug   2020     16
#R&gt;   7 Ashland Sep   2020     94
#R&gt;   8 Ashland Oct   2020    167
#R&gt;   9 Ashland Nov   2020    378
#R&gt;  10 Ashland Dec   2020    331
#R&gt;  # ... with 38 more rows</code></pre>
<p>We will need an actual “date” variable to make a plot of COVID cases over time. The code below does this but uses functions that won’t be introduced until Modules <a href="wrangle-columns.html#wrangle-columns">6</a> and <a href="dates-and-times.html#dates-and-times">9</a>.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb171-1"><a href="pivot.html#cb171-1" aria-hidden="true" tabindex="-1"></a>covABD_L <span class="ot">&lt;-</span> covABD_L <span class="sc">%&gt;%</span></span>
<span id="cb171-2"><a href="pivot.html#cb171-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Date=</span>lubridate<span class="sc">::</span><span class="fu">mdy</span>(<span class="fu">paste</span>(Month,<span class="st">&quot;1&quot;</span>,Year,<span class="at">sep=</span><span class="st">&quot;-&quot;</span>)))</span>
<span id="cb171-3"><a href="pivot.html#cb171-3" aria-hidden="true" tabindex="-1"></a>covABD_L</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 48 x 5
#R&gt;  # Groups:   County [3]
#R&gt;     County  Month Year  Cases Date      
#R&gt;     &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt; &lt;dbl&gt; &lt;date&gt;    
#R&gt;   1 Ashland Mar   2020      1 2020-03-01
#R&gt;   2 Ashland Apr   2020      1 2020-04-01
#R&gt;   3 Ashland May   2020      0 2020-05-01
#R&gt;   4 Ashland Jun   2020      1 2020-06-01
#R&gt;   5 Ashland Jul   2020     16 2020-07-01
#R&gt;   6 Ashland Aug   2020     16 2020-08-01
#R&gt;   7 Ashland Sep   2020     94 2020-09-01
#R&gt;   8 Ashland Oct   2020    167 2020-10-01
#R&gt;   9 Ashland Nov   2020    378 2020-11-01
#R&gt;  10 Ashland Dec   2020    331 2020-12-01
#R&gt;  # ... with 38 more rows</code></pre>
<p>Finally, these data can be graphed as shown below.</p>
<p><img src="BookWrangling_files/figure-html/unnamed-chunk-108-1.png" width="432" style="display: block; margin: auto;" /></p>
<p> </p>
</div>
<div id="abundance-of-mayflies" class="section level3" number="5.4.2">
<h3><span class="header-section-number">5.4.2</span> Abundance of Mayflies</h3>
<p>In 1990 technicians for the U.S. Geological Survey recorded the abundance of mayflies (Ephemeroptera) in 10 1 m<sup>2</sup> quadrats in Chequamegon Bay. In 2020 they repeated the collections at the same locations. Their data are recorded in <code>ephem</code> as shown below.</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb173-1"><a href="pivot.html#cb173-1" aria-hidden="true" tabindex="-1"></a>ephem</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 20 x 5
#R&gt;       loc hab    depth  year abundance
#R&gt;     &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt; &lt;dbl&gt;     &lt;dbl&gt;
#R&gt;   1   101 Sand      16  1990        47
#R&gt;   2   101 Sand      16  2020        46
#R&gt;   3   102 Sand      20  1990        44
#R&gt;   4   102 Sand      20  2020        42
#R&gt;   5   103 Muck      23  1990        50
#R&gt;   6   103 Muck      23  2020        53
#R&gt;   7   104 Cobble    27  1990        54
#R&gt;   8   104 Cobble    27  2020        56
#R&gt;   9   105 Sand      15  1990        52
#R&gt;  10   105 Sand      15  2020        43
#R&gt;  11   106 Muck      21  1990        25
#R&gt;  12   106 Muck      21  2020        30
#R&gt;  13   107 Cobble    27  1990        36
#R&gt;  14   107 Cobble    27  2020        20
#R&gt;  15   108 Sand      13  1990        22
#R&gt;  16   108 Sand      13  2020        18
#R&gt;  17   109 Sand      10  1990        28
#R&gt;  18   109 Sand      10  2020        28
#R&gt;  19   110 Cobble    23  1990        40
#R&gt;  20   110 Cobble    23  2020        36</code></pre>
<p>The researchers want to compute the mean change in abundance across all ten quadrats. To facilitate that calculation these data need to be converted to a wider format that will have the 1990 and 2020 data in separate columns. In this case, potential names for the variables in the new wider format are in <code>year</code>. The values to be put in those columns are in <code>abundance</code>. The rest of the variables should be maintained as they identify the observation (i.e., a quadrat year combination). With these definitions these data are converted to a wider format with the following code.</p>
<div class="sourceCode" id="cb175"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb175-1"><a href="pivot.html#cb175-1" aria-hidden="true" tabindex="-1"></a>ephem2 <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(ephem,<span class="at">names_from=</span>year,<span class="at">values_from=</span>abundance)</span>
<span id="cb175-2"><a href="pivot.html#cb175-2" aria-hidden="true" tabindex="-1"></a>ephem2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 10 x 5
#R&gt;       loc hab    depth `1990` `2020`
#R&gt;     &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;  &lt;dbl&gt;  &lt;dbl&gt;
#R&gt;   1   101 Sand      16     47     46
#R&gt;   2   102 Sand      20     44     42
#R&gt;   3   103 Muck      23     50     53
#R&gt;   4   104 Cobble    27     54     56
#R&gt;   5   105 Sand      15     52     43
#R&gt;   6   106 Muck      21     25     30
#R&gt;   7   107 Cobble    27     36     20
#R&gt;   8   108 Sand      13     22     18
#R&gt;   9   109 Sand      10     28     28
#R&gt;  10   110 Cobble    23     40     36</code></pre>
<p>This accomplishes the task at hand, but the two new variables are called <code>1990</code> and <code>2020</code>, which are non-standard variable names in R (i.e., they start with numbers). This issue can be avoided by providing a string to be used as a prefix to the names in <code class="inline">names_prefix=</code>.</p>
<div class="sourceCode" id="cb177"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb177-1"><a href="pivot.html#cb177-1" aria-hidden="true" tabindex="-1"></a>ephem2 <span class="ot">&lt;-</span> <span class="fu">pivot_wider</span>(ephem,<span class="at">names_from=</span>year,<span class="at">names_prefix=</span><span class="st">&quot;year_&quot;</span>,<span class="at">values_from=</span>abundance)</span>
<span id="cb177-2"><a href="pivot.html#cb177-2" aria-hidden="true" tabindex="-1"></a>ephem2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 10 x 5
#R&gt;       loc hab    depth year_1990 year_2020
#R&gt;     &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
#R&gt;   1   101 Sand      16        47        46
#R&gt;   2   102 Sand      20        44        42
#R&gt;   3   103 Muck      23        50        53
#R&gt;   4   104 Cobble    27        54        56
#R&gt;   5   105 Sand      15        52        43
#R&gt;   6   106 Muck      21        25        30
#R&gt;   7   107 Cobble    27        36        20
#R&gt;   8   108 Sand      13        22        18
#R&gt;   9   109 Sand      10        28        28
#R&gt;  10   110 Cobble    23        40        36</code></pre>
<p>The code below, which will not be introduced until Section <a href="wrangle-columns.html#adding-variables">6.6</a>, creates a new variable that is the difference in abundance between the two years.</p>
<div class="sourceCode" id="cb179"><pre class="sourceCode r RCODE"><code class="sourceCode r"><span id="cb179-1"><a href="pivot.html#cb179-1" aria-hidden="true" tabindex="-1"></a>ephem2 <span class="ot">&lt;-</span> ephem2 <span class="sc">%&gt;%</span></span>
<span id="cb179-2"><a href="pivot.html#cb179-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">diff20_90=</span>year_2020<span class="sc">-</span>year_1990)</span>
<span id="cb179-3"><a href="pivot.html#cb179-3" aria-hidden="true" tabindex="-1"></a>ephem2</span></code></pre></div>
<pre class="ROUTPUT"><code>#R&gt;  # A tibble: 10 x 6
#R&gt;       loc hab    depth year_1990 year_2020 diff20_90
#R&gt;     &lt;int&gt; &lt;chr&gt;  &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;     &lt;dbl&gt;
#R&gt;   1   101 Sand      16        47        46        -1
#R&gt;   2   102 Sand      20        44        42        -2
#R&gt;   3   103 Muck      23        50        53         3
#R&gt;   4   104 Cobble    27        54        56         2
#R&gt;   5   105 Sand      15        52        43        -9
#R&gt;   6   106 Muck      21        25        30         5
#R&gt;   7   107 Cobble    27        36        20       -16
#R&gt;   8   108 Sand      13        22        18        -4
#R&gt;   9   109 Sand      10        28        28         0
#R&gt;  10   110 Cobble    23        40        36        -4</code></pre>
<p>These data could then be easily plotted or summarized.</p>
<p><img src="BookWrangling_files/figure-html/unnamed-chunk-114-1.png" width="336" style="display: block; margin: auto;" /></p>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="19">
<li id="fn19"><p>Converting and graphing these data will be shown in Section <a href="pivot.html#pivoting-examples">5.4</a>.<a href="pivot.html#fnref19" class="footnote-back">↩︎</a></p></li>
<li id="fn20"><p>There are still other ways (e.g., <code class="inline">cols=contains("x")</code>) but these four would be the most common given the names in this data frame.<a href="pivot.html#fnref20" class="footnote-back">↩︎</a></p></li>
<li id="fn21"><p>There are other arguments to <code class="inline">pivot_longer()</code> for dealing with more complicated naming issues.<a href="pivot.html#fnref21" class="footnote-back">↩︎</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="relational-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="wrangle-columns.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": true,
"facebook": false,
"twitter": false,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": false
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section",
"scroll_highlight": true
},
"search": true
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
